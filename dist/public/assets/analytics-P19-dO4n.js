import{u as L,b as $,a as O,d as R,j as e,C as n,e as c,U as W,V as H,W as y,X as p,N as d,O as x,S as m}from"./index-DzUQlMCL.js";import{E as I}from"./layout-D-IzPikD.js";import{B as K,C as f,X as v,L as o,Y as h,T as b,a as N,b as _,R as U}from"./BarChart-BJux3iWp.js";import{L as S,a as u,T as F}from"./LineChart-Cdgvi4LU.js";import{T as E}from"./trending-down-BMP5vP7Q.js";import"./settings-C3McDjct.js";import"./log-out-DkZZLLuv.js";import"./file-text-xMDIOZi1.js";const s={margin:{top:20,right:30,left:20,bottom:30},gridDashArray:"3 3",axisHeight:60,axisAngle:-45,labelOffset:{bottom:20,left:10,right:10},lineStrokeWidth:2,dotRadius:{normal:4,active:6},legendHeight:36,chartHeight:400},w=(r,t)=>{const l=new Date(r);switch(t){case"hourly":return l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});case"daily":return l.toLocaleDateString([],{weekday:"short"});case"weekly":return`Week ${Math.ceil(l.getDate()/7)}`;default:return r}},q=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r),T=({active:r,payload:t,label:l})=>r&&t&&t.length?e.jsxs("div",{className:"bg-background border rounded-lg p-3 shadow-lg",children:[e.jsx("p",{className:"font-medium",children:l}),t.map((a,g)=>e.jsxs("p",{className:"flex items-center gap-2",style:{color:a.color},children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:a.color}}),e.jsxs("span",{children:[a.name,": "]}),e.jsx("span",{className:"font-medium",children:a.name.toLowerCase().includes("volume")||a.name.toLowerCase().includes("amount")?q(a.value):a.value.toLocaleString()})]},g))]}):null,j=({title:r,value:t,subtitle:l,trend:a})=>e.jsxs(n,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:r}),a!==void 0&&e.jsxs("span",{className:`flex items-center ${a>=0?"text-green-500":"text-red-500"}`,children:[a>=0?e.jsx(F,{className:"h-4 w-4"}):e.jsx(E,{className:"h-4 w-4"}),e.jsxs("span",{className:"ml-1 text-xs",children:[Math.abs(a),"%"]})]})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t}),l&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:l})]})]}),D=({children:r})=>e.jsx("div",{className:"relative h-[400px] w-full",children:e.jsx(U,{width:"100%",height:"100%",children:r})}),B=()=>e.jsxs("div",{className:"space-y-4 animate-pulse",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Array(4).fill(0).map((r,t)=>e.jsxs(n,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(m,{className:"h-4 w-24"})}),e.jsxs(c,{children:[e.jsx(m,{className:"h-8 w-32 mb-2"}),e.jsx(m,{className:"h-3 w-40"})]})]},t))}),e.jsxs(n,{children:[e.jsx(d,{children:e.jsx(m,{className:"h-6 w-32"})}),e.jsx(c,{children:e.jsx(m,{className:"h-[400px] w-full"})})]})]});function Q(){const{user:r}=L(),t=$(),[,l]=O();if(r&&!r.isEmployee)return console.log("Non-employee user attempted to access analytics:",r.username),l("/dashboard"),null;const{data:a,isLoading:g,error:k}=R({queryKey:["/api/employee/analytics"],queryFn:async()=>{console.log("Fetching employee analytics data");try{const i=await fetch("/api/employee/analytics",{credentials:"include",headers:{Accept:"application/json","Cache-Control":"no-cache"}});if(!i.ok)throw console.error("Failed to fetch analytics:",{status:i.status,statusText:i.statusText}),new Error("Failed to fetch analytics data");const A=await i.json();return console.log("Analytics data received:",{dataPreview:JSON.stringify(A).slice(0,200)+"...",timestamp:new Date().toISOString()}),A}catch(i){throw console.error("Analytics fetch error:",i),i}},enabled:!!(r!=null&&r.isEmployee),staleTime:5*60*1e3,retry:2}),C=[{id:"analytics",title:t("analytics"),defaultSize:100,content:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:t("dashboard_analytics")}),g?e.jsx(B,{}):k||!(a!=null&&a.yearToDate)?e.jsx(n,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-2",children:t(k?"analytics_error":"no_analytics_data")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("please_try_again_later")})]})})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsx(j,{title:t("total_transactions"),value:a.yearToDate.totalTransactions.toLocaleString(),subtitle:`${t("sepa")}: ${a.yearToDate.deposits.count} | USDT: ${a.yearToDate.orders.count}`,trend:5.2}),e.jsx(j,{title:t("total_volume"),value:`$${a.yearToDate.totalAmount.toLocaleString()}`,subtitle:`${t("sepa")}: $${a.yearToDate.deposits.amount.toLocaleString()} | USDT: $${a.yearToDate.orders.amount.toLocaleString()}`,trend:3.8}),e.jsx(j,{title:t("active_users"),value:a.yearToDate.uniqueActiveUsers.toLocaleString(),subtitle:`${t("total_clients")}: ${a.yearToDate.totalClients.toLocaleString()}`,trend:-1.5}),e.jsx(j,{title:t("success_rate"),value:`${((a.yearToDate.deposits.count+a.yearToDate.orders.count)/a.yearToDate.totalTransactions*100).toFixed(1)}%`,subtitle:t("completed_transactions"),trend:.5})]}),e.jsxs(W,{defaultValue:"daily",className:"space-y-4",children:[e.jsxs(H,{className:"grid w-full grid-cols-3 lg:w-[400px]",children:[e.jsx(y,{value:"daily",children:t("daily")}),e.jsx(y,{value:"weekly",children:t("weekly")}),e.jsx(y,{value:"monthly",children:t("monthly")})]}),e.jsx(p,{value:"daily",className:"space-y-4",children:e.jsxs(n,{children:[e.jsxs(d,{children:[e.jsx(x,{children:t("hourly_activity")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("today_transactions_overview")})]}),e.jsx(c,{children:e.jsx(D,{children:e.jsxs(K,{data:a.daily.timeline.map(i=>({...i,timestamp:w(i.timestamp,"hourly")})),margin:s.margin,children:[e.jsx(f,{strokeDasharray:s.gridDashArray}),e.jsx(v,{dataKey:"timestamp",angle:s.axisAngle,textAnchor:"end",height:s.axisHeight,children:e.jsx(o,{value:t("time"),position:"bottom",offset:s.labelOffset.bottom})}),e.jsx(h,{children:e.jsx(o,{value:t("count"),angle:-90,position:"left",offset:s.labelOffset.left})}),e.jsx(b,{content:e.jsx(T,{})}),e.jsx(N,{verticalAlign:"top",height:s.legendHeight}),e.jsx(_,{name:t("deposits"),dataKey:"deposits",fill:"hsl(var(--primary))",radius:[4,4,0,0]}),e.jsx(_,{name:t("orders"),dataKey:"orders",fill:"hsl(var(--destructive))",radius:[4,4,0,0]})]})})})]})}),e.jsx(p,{value:"weekly",className:"space-y-4",children:e.jsxs(n,{children:[e.jsxs(d,{children:[e.jsx(x,{children:t("daily_breakdown")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("weekly_transactions_overview")})]}),e.jsx(c,{children:e.jsx(D,{children:e.jsxs(S,{data:a.weekly.timeline.map(i=>({...i,timestamp:w(i.timestamp,"daily")})),margin:s.margin,children:[e.jsx(f,{strokeDasharray:s.gridDashArray}),e.jsx(v,{dataKey:"timestamp",angle:s.axisAngle,textAnchor:"end",height:s.axisHeight,children:e.jsx(o,{value:t("day"),position:"bottom",offset:s.labelOffset.bottom})}),e.jsx(h,{yAxisId:"left",children:e.jsx(o,{value:t("volume"),angle:-90,position:"left",offset:s.labelOffset.left})}),e.jsx(h,{yAxisId:"right",orientation:"right",children:e.jsx(o,{value:t("users"),angle:90,position:"right",offset:s.labelOffset.right})}),e.jsx(b,{content:e.jsx(T,{})}),e.jsx(N,{verticalAlign:"top",height:s.legendHeight}),e.jsx(u,{yAxisId:"left",name:t("transaction_volume"),type:"monotone",dataKey:"amount",stroke:"hsl(var(--primary))",strokeWidth:s.lineStrokeWidth,dot:{r:s.dotRadius.normal},activeDot:{r:s.dotRadius.active}}),e.jsx(u,{yAxisId:"right",name:t("active_users"),type:"monotone",dataKey:"activeUsers",stroke:"hsl(var(--destructive))",strokeWidth:s.lineStrokeWidth,dot:{r:s.dotRadius.normal},activeDot:{r:s.dotRadius.active}})]})})})]})}),e.jsx(p,{value:"monthly",className:"space-y-4",children:e.jsxs(n,{children:[e.jsxs(d,{children:[e.jsx(x,{children:t("monthly_trends")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("monthly_transactions_overview")})]}),e.jsx(c,{children:e.jsx(D,{children:e.jsxs(S,{data:a.monthly.timeline.map(i=>({...i,timestamp:w(i.timestamp,"weekly")})),margin:s.margin,children:[e.jsx(f,{strokeDasharray:s.gridDashArray}),e.jsx(v,{dataKey:"timestamp",angle:s.axisAngle,textAnchor:"end",height:s.axisHeight,children:e.jsx(o,{value:t("week"),position:"bottom",offset:s.labelOffset.bottom})}),e.jsx(h,{yAxisId:"left",children:e.jsx(o,{value:t("volume"),angle:-90,position:"left",offset:s.labelOffset.left})}),e.jsx(h,{yAxisId:"right",orientation:"right",children:e.jsx(o,{value:t("users"),angle:90,position:"right",offset:s.labelOffset.right})}),e.jsx(b,{content:e.jsx(T,{})}),e.jsx(N,{verticalAlign:"top",height:s.legendHeight}),e.jsx(u,{yAxisId:"left",name:t("transaction_volume"),type:"monotone",dataKey:"amount",stroke:"hsl(var(--primary))",strokeWidth:s.lineStrokeWidth,dot:{r:s.dotRadius.normal},activeDot:{r:s.dotRadius.active}}),e.jsx(u,{yAxisId:"right",name:t("active_users"),type:"monotone",dataKey:"activeUsers",stroke:"hsl(var(--destructive))",strokeWidth:s.lineStrokeWidth,dot:{r:s.dotRadius.normal},activeDot:{r:s.dotRadius.active}})]})})})]})})]})]})]})}];return e.jsx(I,{children:e.jsxs("div",{className:"container py-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:t("dashboard_analytics")}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:C.map(i=>e.jsxs(n,{children:[e.jsx(d,{children:e.jsx(x,{children:i.title})}),e.jsx(c,{children:i.content})]},i.id))})]})})}export{Q as default};
