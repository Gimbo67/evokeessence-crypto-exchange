import{r as n,h as F,b as P,j as e,C as f,N as b,O as C,Q as y,e as U,y as N,B as u,Y as w,Z as E,a1 as _,f as r,a0 as $}from"./index-DzUQlMCL.js";import{T as H,a as z,b as S,c as i,d as I,e as l}from"./table-CxCbk9gb.js";import{D as V,b as G,c as J,d as W}from"./dialog-kbAvU9vg.js";import{S as Q}from"./switch-Dhi0KNo9.js";import{E as X}from"./eye-DGtliPfs.js";function re(){const[k,T]=n.useState([]),[Y,D]=n.useState(!0),[c,K]=n.useState(null),[j,x]=n.useState(""),[R,o]=n.useState(!1),[t,O]=n.useState("approve"),{toast:d}=F();P(),n.useEffect(()=>{m()},[]);const m=async()=>{try{const a=await fetch("/api/admin/kyc-users",{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch KYC users");const s=await a.json();T(s)}catch(a){console.error("Error fetching KYC users:",a),d({title:"Error",description:"Failed to load KYC users. Please try again.",variant:"destructive"})}finally{D(!1)}},v=async(a,s,g)=>{try{if(!(await fetch(`/api/kyc/manual-decision/${a}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:s,reason:g})})).ok)throw new Error("Failed to update KYC status");d({title:"Success",description:`KYC status updated to ${s}`,variant:"default"}),m(),o(!1),x("")}catch(h){console.error("Error updating KYC status:",h),d({title:"Error",description:"Failed to update KYC status. Please try again.",variant:"destructive"})}},A=async(a,s,g)=>{try{if(!(await fetch(`/api/kyc/manual-override/${a}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({enabled:s,reason:g})})).ok)throw new Error("Failed to toggle manual override");d({title:"Success",description:`Manual override ${s?"enabled":"disabled"}`,variant:"default"}),m(),o(!1),x("")}catch(h){console.error("Error toggling manual override:",h),d({title:"Error",description:"Failed to toggle manual override. Please try again.",variant:"destructive"})}},p=(a,s)=>{K(a),O(s),o(!0),x("")},L=()=>{if(c)switch(t){case"approve":v(c.id,"approved",j);break;case"reject":v(c.id,"rejected",j);break;case"toggle_override":A(c.id,!c.manualOverrideEnabled,j);break}},M=a=>{switch(a.toLowerCase()){case"approved":return e.jsxs(r,{className:"bg-green-100 text-green-800",children:[e.jsx(w,{className:"h-3 w-3 mr-1"}),"Approved"]});case"rejected":return e.jsxs(r,{className:"bg-red-100 text-red-800",children:[e.jsx(E,{className:"h-3 w-3 mr-1"}),"Rejected"]});case"pending":return e.jsxs(r,{className:"bg-yellow-100 text-yellow-800",children:[e.jsx($,{className:"h-3 w-3 mr-1"}),"Pending"]});default:return e.jsx(r,{variant:"secondary",children:"Not Started"})}},B=(a,s)=>{if(!a)return e.jsx(r,{variant:"outline",children:"No SumSub Data"});if(a==="completed"&&s)switch(s){case"GREEN":return e.jsx(r,{className:"bg-green-100 text-green-800",children:"✓ GREEN"});case"RED":return e.jsx(r,{className:"bg-red-100 text-red-800",children:"✗ RED"});case"YELLOW":return e.jsx(r,{className:"bg-yellow-100 text-yellow-800",children:"⚠ YELLOW"});default:return e.jsx(r,{variant:"outline",children:s})}return e.jsx(r,{variant:"outline",children:a})};return Y?e.jsx(f,{children:e.jsxs(b,{children:[e.jsx(C,{children:"KYC Management"}),e.jsx(y,{children:"Loading KYC users..."})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(f,{children:[e.jsxs(b,{children:[e.jsx(C,{children:"KYC Management"}),e.jsx(y,{children:"Manage user KYC verification status and manual overrides"})]}),e.jsx(U,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(H,{children:[e.jsx(z,{children:e.jsxs(S,{children:[e.jsx(i,{children:"User"}),e.jsx(i,{children:"Email"}),e.jsx(i,{children:"KYC Status"}),e.jsx(i,{children:"SumSub Status"}),e.jsx(i,{children:"Manual Override"}),e.jsx(i,{children:"Actions"})]})}),e.jsx(I,{children:k.map(a=>e.jsxs(S,{children:[e.jsx(l,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.fullName||a.username}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",a.id]})]})}),e.jsx(l,{children:a.email}),e.jsx(l,{children:M(a.kycStatus)}),e.jsx(l,{children:B(a.sumsubReviewStatus,a.sumsubReviewResult)}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{checked:a.manualOverrideEnabled,onCheckedChange:()=>p(a,"toggle_override")}),e.jsx(N,{className:"text-sm",children:a.manualOverrideEnabled?"Enabled":"Disabled"})]})}),e.jsx(l,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>p(a,"approve"),disabled:a.kycStatus==="approved",children:[e.jsx(w,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>p(a,"reject"),disabled:a.kycStatus==="rejected",children:[e.jsx(E,{className:"h-4 w-4 mr-1"}),"Reject"]}),a.sumsubApplicantId&&e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>window.open(`https://cockpit.sumsub.com/checkus/#/applicant/${a.sumsubApplicantId}`,"_blank"),children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),"View"]})]})})]},a.id))})]})})})]}),e.jsx(V,{open:R,onOpenChange:o,children:e.jsxs(G,{children:[e.jsx(J,{children:e.jsxs(W,{children:[t==="approve"&&"Approve KYC Verification",t==="reject"&&"Reject KYC Verification",t==="toggle_override"&&"Toggle Manual Override"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"reason",children:"Reason (optional)"}),e.jsx(_,{id:"reason",placeholder:"Enter reason for this action...",value:j,onChange:a=>x(a.target.value),className:"mt-1"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsxs(u,{onClick:L,children:[t==="approve"&&"Approve",t==="reject"&&"Reject",t==="toggle_override"&&"Toggle Override"]})]})]})]})})]})}export{re as KycManagement,re as default};
