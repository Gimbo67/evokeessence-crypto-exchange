import{b as v,h as N,J as k,d as w,i as b,j as e,L as S,C as l,e as d,N as p,O as u,Q as m,y as i,f as T,z as $,A as K,D as Y,E as B,b6 as E,F as h,B as D}from"./index-DzUQlMCL.js";import{E as y}from"./layout-D-IzPikD.js";import"./settings-C3McDjct.js";import"./log-out-DkZZLLuv.js";import"./file-text-xMDIOZi1.js";function q({id:g}){const s=v(),{toast:x}=N(),f=k(),c=parseInt(g||"0"),{data:a,isLoading:_}=w({queryKey:[`/api/employee/clients/${c}`],queryFn:async()=>{try{console.log(`Attempting to fetch client ${c} via bypass endpoint`);const t=await fetch(`/bypass/employee/clients/${c}`,{credentials:"include"});if(console.log("Bypass endpoint response status:",t.status),console.log("Bypass endpoint content type:",t.headers.get("Content-Type")),t.ok){const n=t.headers.get("Content-Type");if(n&&n.includes("application/json")){const r=await t.json();return console.log(`Successfully fetched client ${c} via bypass endpoint:`,r),r}else console.warn("Bypass endpoint returned non-JSON content:",n)}console.log(`Attempting regular endpoint for client ${c}`);const o=await fetch(`/api/employee/clients/${c}`,{credentials:"include"});if(console.log("Regular endpoint response status:",o.status),console.log("Regular endpoint content type:",o.headers.get("Content-Type")),!o.ok)throw new Error(`Failed to fetch client details for ID ${c}`);return o.json()}catch(t){throw console.error(`Error fetching details for client ${c}:`,t),t}},enabled:c>0}),C=b({mutationFn:async t=>{console.log(`Attempting to update KYC status for client ${c} to ${t}`);try{console.log("Using bypass endpoint for KYC status update");const n=await fetch(`/bypass/employee/clients/${c}/kyc`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({kycStatus:t}),credentials:"include"});if(console.log("Bypass KYC update response status:",n.status),console.log("Bypass KYC update content type:",n.headers.get("Content-Type")),n.ok){const r=n.headers.get("Content-Type");if(r&&r.includes("application/json")){const j=await n.json();return console.log("Successfully updated KYC status via bypass endpoint:",j),j}else console.warn("Bypass endpoint returned non-JSON content for KYC update:",r)}else console.warn(`Bypass endpoint failed with status ${n.status}:`,await n.text())}catch(n){console.error("Error using bypass endpoint for KYC update:",n)}console.log("Attempting regular endpoint for KYC status update");const o=await fetch(`/api/employee/clients/${c}/kyc`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({kycStatus:t}),credentials:"include"});if(console.log("Regular KYC update response status:",o.status),console.log("Regular KYC update content type:",o.headers.get("Content-Type")),!o.ok){const n=await o.text();throw console.error(`KYC update failed with status ${o.status}:`,n),new Error(s("update_kyc_failed"))}return o.json()},onSuccess:t=>{console.log("KYC status update successful:",t),f.invalidateQueries({queryKey:[`/api/employee/clients/${c}`]}),x({title:s("success"),description:s("kyc_status_updated_success")})},onError:t=>{console.error("KYC status update error:",t),x({title:s("error"),description:t.message||s("kyc_status_update_failed"),variant:"destructive"})}});return _?e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-center h-[50vh]",children:[e.jsx(S,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-2",children:s("loading_client_data")})]})}):a?e.jsx(y,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(l,{children:[e.jsxs(p,{children:[e.jsx(u,{children:s("client_information")}),e.jsx(m,{children:s("client_details_description")})]}),e.jsx(d,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:s("username")}),e.jsx("p",{className:"text-sm mt-1",children:a.username})]}),e.jsxs("div",{children:[e.jsx(i,{children:s("email")}),e.jsx("p",{className:"text-sm mt-1",children:a.email})]}),e.jsxs("div",{children:[e.jsx(i,{children:s("full_name")}),e.jsx("p",{className:"text-sm mt-1",children:a.fullName})]}),e.jsxs("div",{children:[e.jsx(i,{children:s("phone_number")}),e.jsx("p",{className:"text-sm mt-1",children:a.phoneNumber||s("not_provided")})]}),e.jsxs("div",{children:[e.jsx(i,{children:s("address")}),e.jsx("p",{className:"text-sm mt-1",children:a.address||s("not_provided")})]}),e.jsxs("div",{children:[e.jsx(i,{children:s("country_of_residence")}),e.jsx("p",{className:"text-sm mt-1",children:a.countryOfResidence||s("not_provided")})]})]})})]}),e.jsxs(l,{children:[e.jsxs(p,{children:[e.jsx(u,{children:s("kyc_status")}),e.jsx(m,{children:s("kyc_status_description")})]}),e.jsx(d,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(T,{variant:a.kycStatus==="approved"?"default":a.kycStatus==="rejected"?"destructive":"secondary",children:s(`kyc_${a.kycStatus}`)}),e.jsxs($,{value:a.kycStatus,onValueChange:t=>{C.mutate(t)},children:[e.jsx(K,{className:"w-[180px]",children:e.jsx(Y,{placeholder:s("select_status")})}),e.jsx(B,{children:e.jsxs(E,{children:[e.jsx(h,{value:"pending",children:s("kyc_pending")}),e.jsx(h,{value:"approved",children:s("kyc_approved")}),e.jsx(h,{value:"rejected",children:s("kyc_rejected")})]})})]})]})})]}),e.jsxs(l,{children:[e.jsxs(p,{children:[e.jsx(u,{children:s("kyc_documents")}),e.jsx(m,{children:s("kyc_documents_description")})]}),e.jsx(d,{children:a.kycDocuments&&a.kycDocuments.length>0?e.jsx("div",{className:"grid gap-4",children:a.kycDocuments.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s(`document_type_${t.type}`)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(t.createdAt).toLocaleDateString()}),t.adminComment&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[s("admin_comment"),": ",t.adminComment]})]}),e.jsx(D,{variant:"outline",onClick:()=>window.open(t.fileUrl,"_blank"),children:s("view_document")})]},t.id))}):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:s("no_documents_uploaded")})})]})]})}):e.jsx(y,{children:e.jsx(l,{children:e.jsx(d,{className:"pt-6",children:e.jsx("p",{className:"text-center text-muted-foreground",children:s("client_not_found")})})})})}export{q as default};
