import{c as O,u as X,aU as q,a as P,h as Q,b as G,r as H,d as W,j as e,B as u,C as l,N as d,O as o,Q as p,e as x,f as T,bf as J,U as Z,V as ee,W as y,X as _,b5 as se,aV as te,aI as A,g as w,ak as ae}from"./index-DzUQlMCL.js";import{L as re}from"./log-out-DkZZLLuv.js";import{T as ie,L as E,a as b}from"./LineChart-Cdgvi4LU.js";import{R as C,C as D,X as k,Y as g,T as U,a as L,B as ne,b as F}from"./BarChart-BJux3iWp.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=O("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]),c=(r,N="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:N,minimumFractionDigits:2,maximumFractionDigits:2}).format(r),je=()=>{const{user:r}=X(),{logout:N}=q(),[le,I]=P(),{toast:f}=Q(),s=G(),[K,B]=H.useState("overview"),M=async()=>{try{await N(),I("/auth"),f({title:s("success"),description:s("logout_success")})}catch(t){console.error("Error logging out:",t),f({variant:"destructive",title:s("error"),description:s("logout_failed")})}},{data:m,isLoading:Y,error:$,refetch:z}=W({queryKey:["contractor-analytics"],queryFn:async()=>{try{return(await ae.get("/api/contractor/analytics",{withCredentials:!0})).data}catch(t){throw console.error("Error fetching contractor analytics:",t),t}},staleTime:6e4}),i=(m==null?void 0:m.referredDeposits)||[],a=m?{totalCommissionEarned:m.totalCommission||0,totalReferredDeposits:m.totalReferredDeposits||0,activeReferrals:m.referredClientsCount||0,pendingCommissions:i.filter(t=>t.status==="pending").reduce((t,n)=>t+Number(n.contractorCommission||0),0)}:{totalCommissionEarned:0,totalReferredDeposits:0,activeReferrals:0,pendingCommissions:0},v=(()=>{const t={};for(let n=5;n>=0;n--){const h=new Date;h.setMonth(h.getMonth()-n);const j=`${h.toLocaleString("default",{month:"short"})} ${h.getFullYear()}`;t[j]={month:j,commissions:0,deposits:0}}return i.forEach(n=>{const h=new Date(n.createdAt),j=`${h.toLocaleString("default",{month:"short"})} ${h.getFullYear()}`;t[j]&&(t[j].deposits+=n.amount,t[j].commissions+=n.commission)}),Object.values(t)})(),S=()=>{r!=null&&r.referralCode&&(navigator.clipboard.writeText(r.referralCode),f({title:s("success"),description:s("referral_code_copied")}))},R=()=>{z(),f({title:s("refreshed"),description:s("data_updated")})};return Y?e.jsx("div",{className:"container mx-auto p-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-primary"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:s("loading_data")||"Loading data..."})]})}):$?e.jsx("div",{className:"container mx-auto p-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("p",{className:"text-destructive text-lg",children:s("error_loading")||"Error loading data"}),e.jsx(u,{onClick:R,variant:"outline",className:"mt-4",children:s("try_again")||"Try Again"})]})}):e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:s("contractor_dashboard")}),e.jsx("p",{className:"text-muted-foreground",children:s("manage_your_referrals_and_commissions")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{onClick:R,variant:"outline",size:"sm",children:s("refresh_data")}),e.jsxs(u,{onClick:M,variant:"outline",size:"sm",className:"flex items-center gap-1",children:[e.jsx(re,{className:"h-4 w-4"}),s("logout")]})]})]}),e.jsxs(l,{className:"mb-6",children:[e.jsxs(d,{children:[e.jsx(o,{children:s("your_referral_code")}),e.jsx(p,{children:s("share_to_earn_commissions")})]}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{variant:"outline",className:"text-lg font-mono py-2 px-4",children:(r==null?void 0:r.referralCode)||"N/A"}),e.jsxs(u,{size:"sm",variant:"ghost",onClick:S,disabled:!(r!=null&&r.referralCode),children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),s("copy")]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s("commission_rate"),":"," ",e.jsxs("span",{className:"font-medium",children:[(((r==null?void 0:r.contractorCommissionRate)||.0085)*100).toFixed(2),"%"]})]})]})})]}),e.jsxs(Z,{defaultValue:"overview",value:K,onValueChange:B,className:"space-y-4",children:[e.jsxs(ee,{children:[e.jsx(y,{value:"overview",children:s("overview")}),e.jsx(y,{value:"deposits",children:s("deposits")}),e.jsx(y,{value:"analytics",children:s("analytics")})]}),e.jsxs(_,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(l,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:s("total_commissions")}),e.jsx(se,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c((a==null?void 0:a.totalCommissionEarned)||0,"USD")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("total_earnings_to_date")})]})]}),e.jsxs(l,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:s("referral_volume")}),e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c((a==null?void 0:a.totalReferredDeposits)||0,"USD")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("total_deposit_volume")})]})]}),e.jsxs(l,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:s("active_referrals")}),e.jsx(te,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(a==null?void 0:a.activeReferrals)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("clients_with_activity")})]})]}),e.jsxs(l,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:s("pending_commissions")}),e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c((a==null?void 0:a.pendingCommissions)||0,"USD")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("from_pending_deposits")})]})]})]}),e.jsxs(l,{className:"col-span-4",children:[e.jsxs(d,{children:[e.jsx(o,{children:s("commission_trend")}),e.jsx(p,{children:s("monthly_commission_earnings")})]}),e.jsx(x,{className:"h-80",children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(E,{data:v,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(k,{dataKey:"month"}),e.jsx(g,{}),e.jsx(U,{}),e.jsx(L,{}),e.jsx(b,{type:"monotone",dataKey:"commissions",name:s("commissions"),stroke:"#8884d8",activeDot:{r:8}})]})})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsx(o,{children:s("recent_deposits")}),e.jsx(p,{children:s("latest_client_deposits")})]}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[i.slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t.clientUsername||`User #${t.userId}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(t.createdAt).toLocaleDateString()})]})}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-sm font-medium",children:c(t.amount,t.currency)}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",c(t.commission,"USD")," ",s("commission")]})]})]},t.id)),i.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:s("no_deposits_yet")})]})})]}),e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsx(o,{children:s("commission_stats")}),e.jsx(p,{children:s("deposit_vs_commission")})]}),e.jsx(x,{className:"h-[300px]",children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(ne,{width:500,height:300,data:v,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(k,{dataKey:"month"}),e.jsx(g,{}),e.jsx(U,{}),e.jsx(L,{}),e.jsx(F,{dataKey:"deposits",name:s("deposits"),fill:"#82ca9d"}),e.jsx(F,{dataKey:"commissions",name:s("commissions"),fill:"#8884d8"})]})})})]})]})]}),e.jsx(_,{value:"deposits",className:"space-y-4",children:e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsx(o,{children:s("referred_client_deposits")}),e.jsx(p,{children:s("all_deposits_from_your_referrals")})]}),e.jsx(x,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("client")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("amount")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("commission")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("status")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("date")})]})}),e.jsxs("tbody",{className:"bg-background divide-y divide-border",children:[i.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:t.clientUsername||`User #${t.userId}`}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:c(t.amount,t.currency)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:c(t.commission,"USD")}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:e.jsx(T,{variant:t.status==="completed"?"success":t.status==="pending"?"outline":"destructive",children:t.status})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:new Date(t.createdAt).toLocaleDateString()})]},t.id)),i.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-sm text-muted-foreground",children:s("no_deposits_found")})})]})]})})})]})}),e.jsx(_,{value:"analytics",className:"space-y-4",children:e.jsxs(l,{className:"col-span-4",children:[e.jsxs(d,{children:[e.jsx(o,{children:s("performance_analytics")}),e.jsx(p,{children:s("comprehensive_referral_metrics")})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:s("summary_statistics")}),e.jsx(A,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("conversion_rate")}),e.jsxs("p",{className:"text-2xl font-bold",children:[(((a==null?void 0:a.activeReferrals)||0)>0?i.length/((a==null?void 0:a.activeReferrals)||1)*100:0).toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("avg_deposit")}),e.jsx("p",{className:"text-2xl font-bold",children:c(i.length>0?i.reduce((t,n)=>t+n.amount,0)/i.length:0,"USD")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("avg_commission")}),e.jsx("p",{className:"text-2xl font-bold",children:c(i.length>0?i.reduce((t,n)=>t+n.commission,0)/i.length:0,"USD")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("commission_rate")}),e.jsxs("p",{className:"text-2xl font-bold",children:[(((r==null?void 0:r.contractorCommissionRate)||.0085)*100).toFixed(2),"%"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:s("performance_breakdown")}),e.jsx(A,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:s("completed_deposits")}),e.jsx("span",{className:"text-sm font-medium",children:i.filter(t=>t.status==="completed").length})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:s("pending_deposits")}),e.jsx("span",{className:"text-sm font-medium",children:i.filter(t=>t.status==="pending").length})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:s("total_volume")}),e.jsx("span",{className:"text-sm font-medium",children:c((a==null?void 0:a.totalReferredDeposits)||0,"USD")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:s("total_commission")}),e.jsx("span",{className:"text-sm font-medium",children:c((a==null?void 0:a.totalCommissionEarned)||0,"USD")})]})]})]})]}),e.jsx("div",{className:"h-[350px] mt-8",children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(E,{data:v,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(k,{dataKey:"month"}),e.jsx(g,{yAxisId:"left"}),e.jsx(g,{yAxisId:"right",orientation:"right"}),e.jsx(U,{}),e.jsx(L,{}),e.jsx(b,{yAxisId:"left",type:"monotone",dataKey:"deposits",name:s("deposit_volume"),stroke:"#82ca9d",activeDot:{r:8}}),e.jsx(b,{yAxisId:"right",type:"monotone",dataKey:"commissions",name:s("commission_earnings"),stroke:"#8884d8",activeDot:{r:8}})]})})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:s("performance_tips")}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsxs("li",{className:"flex items-start",children:[e.jsx(w,{className:"h-5 w-5 mr-2 text-primary shrink-0"}),s("tip_share_code")]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx(w,{className:"h-5 w-5 mr-2 text-primary shrink-0"}),s("tip_educate_clients")]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx(w,{className:"h-5 w-5 mr-2 text-primary shrink-0"}),s("tip_regular_follow_up")]})]})]})]})]})})]})]})};export{je as default};
