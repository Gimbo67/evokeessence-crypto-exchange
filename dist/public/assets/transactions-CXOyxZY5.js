import{c as k,b as Z,r as f,h as ee,J as se,d as ae,i as E,a2 as re,a3 as te,j as e,C as I,e as U,I as $,z as H,A as _,E as F,F as l,a4 as ne,a5 as oe,a6 as ie,a7 as le,a8 as ce,a9 as de,aa as ue,f as he,D as me,B as b,ab as pe,ac as xe,ad as je,ae as fe,af as ge,ag as ye,ah as we,ai as ve,aj as be,ak as g}from"./index-DzUQlMCL.js";import{T as Ce,a as Ne,b as C,c as m,d as Se,e as u}from"./table-CxCbk9gb.js";import{A as Te,a as De,b as Ae,c as Ee,d as He,e as _e,f as Fe,g as ke,h as Le}from"./alert-dialog-DoTVPQra.js";import{D as Ie,b as Ue,c as $e,d as Ve,e as Pe,f as Re}from"./dialog-kbAvU9vg.js";import{A as ze}from"./layout-Dhtj2VcD.js";import{S as Me}from"./search-BvG8QWW9.js";import{E as qe}from"./external-link-yJkabYVq.js";import{T as Oe}from"./trash-2-D7Ii7HN2.js";import"./chart-column-CcdXueSi.js";import"./hard-drive-nPyOXBYa.js";import"./log-out-DkZZLLuv.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=k("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=k("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=k("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),Ke=ve({txHash:be().min(10,"Transaction hash should be at least 10 characters long")});function ns(){const a=Z(),[p,P]=f.useState(""),[y,R]=f.useState("all"),[w,z]=f.useState("all"),[i,M]=f.useState(null),[q,N]=f.useState(!1),{toast:x}=ee(),S=se(),{data:O=[],isLoading:Q,error:T}=ae({queryKey:["/api/admin/transactions"],queryFn:async()=>{try{console.log("Fetching admin transactions...");const s=await g.get("/api/admin/transactions",{withCredentials:!0});console.log("Raw transaction response:",s);const t=Array.isArray(s.data)?s.data:s.data.transactions||s.data;if(!Array.isArray(t))throw console.error("Invalid transactions data format:",t),new Error("Invalid transactions data format: expected array");console.log(`Processing ${t.length} transactions`);const c=t.reduce((r,n)=>(r[n.type]=(r[n.type]||0)+1,r),{});console.log("Transaction types count:",c);const o=t.filter(r=>r.type==="usdc");return console.log(`Found ${o.length} USDC transactions:`,o),t.map(r=>({...r,id:r.id||`unknown-${Math.random()}`,type:r.type||"unknown",amount:typeof r.amount=="number"?r.amount:parseFloat(r.amount||"0"),currency:r.currency||"EUR",status:r.status||"unknown",createdAt:r.createdAt||new Date().toISOString(),initialAmount:r.initialAmount||r.amount||0,commissionAmount:r.commissionAmount||0,totalAmount:r.totalAmount||r.amount||0,reference:r.reference||r.id,user:r.user||{id:r.userId||0,username:r.username||"Unknown",email:r.email||"unknown@example.com"}}))}catch(s){throw console.error("Error fetching transactions:",s),s}},staleTime:3e4,retry:2}),B=E({mutationFn:async({id:s,type:t,status:c})=>{let o="";const[r,n]=s.split("-");if(!n)throw new Error("Invalid transaction ID format");switch(t.toLowerCase()){case"deposit":o=`/api/admin/deposits/${n}`;break;case"usdt":o=`/api/admin/usdt/${n}`;break;case"usdc":o=`/api/admin/usdc/${n}`;break;default:throw new Error(`Invalid transaction type: ${t}`)}return console.log("Updating transaction status:",{id:s,numericId:n,type:t,status:c,endpoint:o}),(await g.patch(o,{status:c},{withCredentials:!0})).data},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/transactions"]}),x({title:a("success"),description:a("transaction_status_updated")})},onError:s=>{console.error("Error updating transaction status:",s),x({variant:"destructive",title:a("error"),description:a("failed_to_update_transaction_status")})}}),D=E({mutationFn:async({id:s,type:t,txHash:c})=>{var o,r;try{const[n,d]=s.split("-");if(!d)throw new Error("Invalid transaction ID format");if(t.toLowerCase()!=="usdc")throw new Error("Transaction hash updates are only supported for USDC transactions");const h=`/api/admin/usdc/${d}`;return console.log("Updating transaction hash:",{id:s,numericId:d,type:t,txHash:c?"[HASH PROVIDED]":"none",endpoint:h}),(await g.patch(h,{txHash:c,status:"successful"},{withCredentials:!0})).data}catch(n){throw console.error("Error updating transaction hash:",n),g.isAxiosError(n)&&(console.error("Status:",(o=n.response)==null?void 0:o.status),console.error("Response data:",(r=n.response)==null?void 0:r.data)),n}},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/admin/transactions"]}),x({title:"Success",description:"Transaction hash updated successfully"}),N(!1)},onError:s=>{console.error("Error updating transaction hash:",s),x({variant:"destructive",title:"Error",description:"Failed to update transaction hash"})}}),K=E({mutationFn:async({id:s,type:t})=>{var c,o;try{const[r,n]=s.split("-");if(!n)throw new Error("Invalid transaction ID format");let d=t.toLowerCase();d==="deposit"&&(d="sepa"),console.log("Deleting transaction:",{id:s,type:t,apiType:d,numericId:n,endpoint:`/api/admin/transactions/${d}/${n}`});const h=await g.delete(`/api/admin/transactions/${d}/${n}`,{withCredentials:!0});return console.log("Delete transaction response:",h.data),h.data}catch(r){throw console.error("Error in deleteTransaction mutation:",r),g.isAxiosError(r)&&(console.error("Status:",(c=r.response)==null?void 0:c.status),console.error("Response data:",(o=r.response)==null?void 0:o.data)),r}},onSuccess:s=>{S.invalidateQueries({queryKey:["/api/admin/transactions"]}),x({title:a("success"),description:a("transaction_deleted_successfully")})},onError:s=>{console.error("Error deleting transaction:",s),x({variant:"destructive",title:a("error"),description:a("failed_to_delete_transaction")})}}),X=async(s,t)=>{try{await B.mutateAsync({id:s.id,type:s.type,status:t})}catch(c){console.error("Error in handleStatusUpdate:",c)}},J=async s=>{try{await K.mutateAsync({id:s.id,type:s.type})}catch(t){console.error("Error in handleDeleteTransaction:",t)}},G=s=>{switch(s.toLowerCase()){case"completed":case"successful":return"bg-green-500/20 text-green-700 hover:bg-green-500/30";case"pending":case"processing":return"bg-yellow-500/20 text-yellow-700 hover:bg-yellow-500/30";case"failed":case"rejected":return"bg-red-500/20 text-red-700 hover:bg-red-500/30";default:return"bg-blue-500/20 text-blue-700 hover:bg-blue-500/30"}},v=(s,t)=>t==="USDC"||t==="USDT"?`${s.toFixed(2)} ${t}`:new Intl.NumberFormat("en-US",{style:"currency",currency:t||"EUR",minimumFractionDigits:2}).format(s),L=O.filter(s=>{var r,n,d,h,A;const t=((n=(r=s.user)==null?void 0:r.username)==null?void 0:n.toLowerCase().includes(p.toLowerCase()))||((h=(d=s.user)==null?void 0:d.email)==null?void 0:h.toLowerCase().includes(p.toLowerCase()))||((A=s.id)==null?void 0:A.toLowerCase().includes(p.toLowerCase()))||s.reference&&s.reference.toLowerCase().includes(p.toLowerCase())||s.txHash&&s.txHash.toLowerCase().includes(p.toLowerCase()),c=y==="all"?!0:s.status.toLowerCase()===y.toLowerCase(),o=w==="all"?!0:s.type.toLowerCase()===w.toLowerCase();return t&&c&&o}),j=re({resolver:te(Ke),defaultValues:{txHash:(i==null?void 0:i.txHash)||""}});f.useEffect(()=>{i&&j.reset({txHash:i.txHash||""})},[i,j]);const W=async s=>{if(i)try{await D.mutateAsync({id:i.id,type:i.type,txHash:s.txHash})}catch(t){console.error("Error in handleTxHashUpdate:",t)}},Y=[{id:"transactions",title:a("transactions"),defaultSize:100,content:e.jsxs("div",{className:"container py-6",children:[e.jsx(I,{className:"mb-6 bg-card/50 backdrop-blur",children:e.jsx(U,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:space-y-0 md:space-x-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Me,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx($,{placeholder:a("search_transactions"),className:"pl-8 bg-background/50",value:p,onChange:s=>P(s.target.value)})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(H,{value:y,onValueChange:R,children:[e.jsx(_,{className:"w-[160px] bg-background/50",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),a(y==="all"?"filter_status":y.toLowerCase())]})}),e.jsxs(F,{children:[e.jsx(l,{value:"all",children:a("all_statuses")}),e.jsx(l,{value:"pending",children:a("pending")}),e.jsx(l,{value:"processing",children:a("processing")}),e.jsx(l,{value:"completed",children:a("completed")}),e.jsx(l,{value:"successful",children:a("successful")}),e.jsx(l,{value:"failed",children:a("failed")})]})]}),e.jsxs(H,{value:w,onValueChange:z,children:[e.jsx(_,{className:"w-[160px] bg-background/50",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),a(w==="all"?"filter_type":`transaction_type_${w}`)]})}),e.jsxs(F,{children:[e.jsx(l,{value:"all",children:a("all_types")}),e.jsx(l,{value:"deposit",children:a("sepa_deposit")}),e.jsx(l,{value:"usdt",children:"USDT"}),e.jsx(l,{value:"usdc",children:"USDC"})]})]})]})]})})}),e.jsx(I,{children:e.jsx(U,{className:"p-6",children:e.jsx("div",{className:"rounded-md border border-border/40",children:e.jsxs(Ce,{children:[e.jsx(Ne,{children:e.jsxs(C,{className:"border-b border-border/40 bg-muted/50",children:[e.jsx(m,{className:"py-3",children:a("date")}),e.jsx(m,{children:a("client")}),e.jsx(m,{children:a("type")}),e.jsx(m,{children:a("reference")}),e.jsx(m,{children:a("amount")}),e.jsx(m,{children:a("status")}),e.jsx(m,{children:a("actions")})]})}),e.jsx(Se,{children:Q?e.jsx(C,{children:e.jsxs(u,{colSpan:7,className:"text-center py-4",children:[a("loading"),"..."]})}):T?e.jsx(C,{children:e.jsxs(u,{colSpan:7,className:"text-center py-4 text-red-500",children:[a("error_loading_transactions"),e.jsx("div",{className:"text-xs mt-2",children:T instanceof Error?T.message:"Unknown error"})]})}):L.length===0?e.jsx(C,{children:e.jsx(u,{colSpan:7,className:"text-center py-4 text-muted-foreground",children:a("no_transactions_found")})}):L.map(s=>e.jsxs(C,{className:"border-b border-border/40 hover:bg-muted/50",children:[e.jsx(u,{className:"py-3",children:ne(new Date(s.createdAt))}),e.jsx(u,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(oe,{href:`/admin/clients/${s.user.id}`,className:"font-medium text-primary hover:underline",children:s.user.username}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.user.email})]})}),e.jsx(u,{children:a(`transaction_type_${s.type}`)}),e.jsx(u,{children:s.reference?e.jsx("span",{className:"text-sm font-mono",children:s.reference}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"-"})}),e.jsx(u,{className:"font-medium",children:e.jsx(ie,{children:e.jsxs(le,{children:[e.jsx(ce,{asChild:!0,children:e.jsxs("div",{className:"flex items-center",children:[v(s.amount,s.currency),e.jsx(de,{className:"h-3 w-3 ml-1 text-muted-foreground"})]})}),e.jsx(ue,{children:e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{children:["Initial: ",v(s.initialAmount||s.amount,s.currency)]}),e.jsxs("div",{children:["Commission: ",v(s.commissionAmount||0,s.currency)]}),e.jsxs("div",{children:["Total: ",v(s.totalAmount||s.amount,s.currency)]})]})})]})})}),e.jsx(u,{children:e.jsx(he,{className:G(s.status),children:s.status})}),e.jsx(u,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(H,{value:s.status,onValueChange:t=>X(s,t),children:[e.jsx(_,{className:"w-[130px]",children:e.jsx(me,{placeholder:a("update_status")})}),e.jsxs(F,{children:[e.jsx(l,{value:"pending",children:a("pending")}),e.jsx(l,{value:"processing",children:a("processing")}),e.jsx(l,{value:"successful",children:a("successful")}),e.jsx(l,{value:"completed",children:a("completed")}),e.jsx(l,{value:"failed",children:a("failed")})]})]}),s.type.toLowerCase()==="usdc"&&e.jsxs(b,{size:"sm",variant:"ghost",className:"flex items-center",onClick:()=>{M(s),N(!0)},children:[e.jsx(Qe,{className:"h-4 w-4 mr-1"}),s.txHash?"Edit TX":"Add TX"]}),s.txHash&&e.jsx(b,{size:"sm",variant:"ghost",asChild:!0,children:e.jsxs("a",{href:`https://solscan.io/tx/${s.txHash}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center",children:[e.jsx(qe,{className:"h-4 w-4 mr-1"}),"TX"]})}),e.jsxs(Te,{children:[e.jsx(De,{asChild:!0,children:e.jsx(b,{size:"sm",variant:"ghost",className:"text-red-500 hover:text-red-700 hover:bg-red-100/30",children:e.jsx(Oe,{className:"h-4 w-4"})})}),e.jsxs(Ae,{children:[e.jsxs(Ee,{children:[e.jsx(He,{children:a("confirm_delete")}),e.jsx(_e,{children:a("confirm_delete_transaction_description",{type:a(`transaction_type_${s.type}`),amount:v(s.amount,s.currency)})})]}),e.jsxs(Fe,{children:[e.jsx(ke,{children:a("cancel")}),e.jsx(Le,{onClick:()=>J(s),className:"bg-red-500 hover:bg-red-600",children:a("delete")})]})]})]})]})})]},s.id))})]})})})})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(ze,{panels:Y}),e.jsx(Ie,{open:q,onOpenChange:N,children:e.jsxs(Ue,{className:"sm:max-w-md",children:[e.jsxs($e,{children:[e.jsx(Ve,{children:i!=null&&i.txHash?"Edit Transaction Hash":"Add Transaction Hash"}),e.jsx(Pe,{children:i!=null&&i.txHash?"Update the transaction hash for this USDC transaction.":"Add a blockchain transaction hash to mark this USDC transaction as complete."})]}),e.jsx(pe,{...j,children:e.jsxs("form",{onSubmit:j.handleSubmit(W),className:"space-y-4",children:[e.jsx(xe,{control:j.control,name:"txHash",render:({field:s})=>e.jsxs(je,{children:[e.jsx(fe,{children:"Transaction Hash"}),e.jsx(ge,{children:e.jsx($,{placeholder:"Enter transaction hash",...s,className:"font-mono text-sm"})}),e.jsx(ye,{children:"Enter the Solana transaction hash for this USDC transaction."}),e.jsx(we,{})]})}),e.jsxs(Re,{className:"mt-4",children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(b,{type:"submit",disabled:D.isPending||!j.formState.isValid,className:"ml-2",children:D.isPending?e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"h-4 w-4 border-2 border-current border-t-transparent rounded-full animate-spin mr-2"}),"Saving..."]}):e.jsxs("span",{className:"flex items-center",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Save"]})})]})]})})]})})]})}export{ns as default};
