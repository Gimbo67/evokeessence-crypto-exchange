import{c as k,a as A,h as I,r as t,a2 as P,j as e,C as q,N as V,O as M,Q as U,e as z,b2 as D,b3 as B,ab as R,ac as x,ad as f,ae as y,af as j,I as d,ah as g,B as w,L as b,az as W,ax as m,ak as u,a3 as H}from"./index-DzUQlMCL.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=k("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]),Q=m.object({username:m.string().min(1,"Username is required"),password:m.string().min(1,"Password is required")});function J(){const[,h]=A(),{toast:o}=I(),[n,i]=t.useState(!1),[p,r]=t.useState(null),[v,N]=t.useState(!1),[c,F]=t.useState(""),[E,L]=t.useState(null),l=P({resolver:H(Q),defaultValues:{username:"",password:""}}),S=async s=>{try{i(!0),r(null),console.log("Attempting login with:",s.username);const a=await u.post("/bypass/auth/login",{username:s.username,password:s.password,isEmployeeLogin:!0});if(console.log("Login response:",a.data),a.data.success)if(a.data.requires2FA)N(!0),L(a.data.userId),o({title:"Two-factor authentication required",description:"Please enter your verification code"});else if(a.data.isEmployee){const T=await u.get("/bypass/user");console.log("User data retrieved:",T.data),o({title:"Login successful",description:"Welcome to the employee portal"}),console.log("Login successful, proceeding with redirection"),setTimeout(()=>{h("/employee/dashboard")},500)}else r("This account does not have employee access");else r(a.data.message||"Invalid username or password")}catch(a){console.error("Login error:",a),r("An error occurred during login. Please try again.")}finally{i(!1)}},C=async s=>{if(s.preventDefault(),!c){o({title:"Verification code required",description:"Please enter your verification code",variant:"destructive"});return}try{i(!0),(await u.post("/bypass/2fa/validate",{userId:E,token:c})).data.success?(o({title:"Login successful",description:"Welcome to the employee portal"}),h("/employee/dashboard")):r("Invalid verification code. Please try again.")}catch(a){console.error("2FA validation error:",a),r("An error occurred during verification. Please try again.")}finally{i(!1)}};return e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted/40 p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Employee Portal"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Access the EvokeEssence employee dashboard"})]}),e.jsxs(q,{children:[e.jsxs(V,{children:[e.jsx(M,{children:"Employee Login"}),e.jsx(U,{children:"Enter your employee credentials to access the dashboard"})]}),e.jsxs(z,{children:[p&&e.jsxs(D,{variant:"destructive",className:"mb-4",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx(B,{children:p})]}),v?e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"twoFactorToken",className:"text-sm font-medium",children:"Verification Code"}),e.jsx(d,{id:"twoFactorToken",placeholder:"Enter your verification code",value:c,onChange:s=>F(s.target.value)})]}),e.jsxs(w,{type:"submit",className:"w-full",disabled:n,children:[n&&e.jsx(b,{className:"mr-2 h-4 w-4 animate-spin"}),"Verify"]})]}):e.jsx(R,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(S),className:"space-y-4",children:[e.jsx(x,{control:l.control,name:"username",render:({field:s})=>e.jsxs(f,{children:[e.jsx(y,{children:"Username"}),e.jsx(j,{children:e.jsx(d,{placeholder:"Enter your username",...s})}),e.jsx(g,{})]})}),e.jsx(x,{control:l.control,name:"password",render:({field:s})=>e.jsxs(f,{children:[e.jsx(y,{children:"Password"}),e.jsx(j,{children:e.jsx(d,{type:"password",placeholder:"Enter your password",...s})}),e.jsx(g,{})]})}),e.jsxs(w,{type:"submit",className:"w-full",disabled:n,children:[n&&e.jsx(b,{className:"mr-2 h-4 w-4 animate-spin"}),"Sign In"]})]})})]}),e.jsx(W,{className:"flex flex-col space-y-2",children:e.jsxs("div",{className:"text-sm text-muted-foreground text-center w-full",children:["Not an employee? ",e.jsx("a",{href:"/auth",className:"text-primary",children:"Sign in as a client"})]})})]})]})})}export{J as default};
