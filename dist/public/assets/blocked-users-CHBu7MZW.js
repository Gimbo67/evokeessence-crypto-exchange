import{u as S,h as B,J as E,b as A,r as j,d as F,i as N,j as e,b0 as b,b1 as f,aH as _,C as y,e as g,N as q,O as H,a0 as K,a1 as P,B as l}from"./index-DzUQlMCL.js";import{T as Q,a as z,b as k,c as a,d as M,e as i}from"./table-CxCbk9gb.js";import{F as D}from"./file-text-xMDIOZi1.js";function I(){const{user:d}=S(),{toast:u}=B(),r=E();A();const[o,c]=j.useState({}),[p,x]=j.useState(null),{data:m=[],isLoading:v}=F({queryKey:["admin-blocked-users"],queryFn:async()=>{const s=await fetch("/api/admin/blocked-users",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch blocked users");return s.json()},enabled:!!(d!=null&&d.isAdmin)}),h=N({mutationFn:async s=>{const t=await fetch(`/api/admin/users/${s}/unblock`,{method:"POST",credentials:"include"});if(!t.ok)throw new Error(await t.text());return t.json()},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-blocked-users"]}),r.invalidateQueries({queryKey:["admin-users"]}),u({title:"Success",description:"User unblocked successfully"})}}),w=N({mutationFn:async({userId:s,notes:t})=>{const n=await fetch(`/api/admin/users/${s}/block-notes`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({notes:t}),credentials:"include"});if(!n.ok)throw new Error(await n.text());return n.json()},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-blocked-users"]}),x(null),c({}),u({title:"Success",description:"Notes updated successfully"})}}),C=s=>{const t=o[s]||"";w.mutate({userId:s,notes:t})},T=(s,t)=>{x(s),c({[s]:t||""})},U=()=>{x(null),c({})};return v?e.jsxs(e.Fragment,{children:[e.jsx(b,{}),e.jsx("div",{className:"container py-6 mt-20",children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{}),e.jsxs("div",{className:"container py-6 mt-20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{className:"h-8 w-8 text-red-500"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Blocked Users"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsxs("span",{children:[m.length," blocked users"]})]})]}),m.length===0?e.jsx(y,{children:e.jsxs(g,{className:"py-12 text-center",children:[e.jsx(f,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Blocked Users"}),e.jsx("p",{className:"text-muted-foreground",children:"All users are currently active."})]})}):e.jsxs(y,{children:[e.jsx(q,{children:e.jsx(H,{children:"Blocked Users Management"})}),e.jsx(g,{children:e.jsxs(Q,{children:[e.jsx(z,{children:e.jsxs(k,{children:[e.jsx(a,{children:"User Info"}),e.jsx(a,{children:"Block Details"}),e.jsx(a,{children:"Notes"}),e.jsx(a,{children:"Account Info"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(M,{children:m.map(s=>{var t;return e.jsxs(k,{children:[e.jsx(i,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:s.username}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email}),s.full_name&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s.full_name})]})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(K,{className:"h-4 w-4"}),new Date(s.blocked_at).toLocaleDateString()]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Reason:"})," ",s.block_reason]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["By: ",((t=s.blockedByAdmin)==null?void 0:t.username)||"Unknown"]})]})}),e.jsx(i,{children:p===s.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{value:o[s.id]||"",onChange:n=>c({...o,[s.id]:n.target.value}),placeholder:"Add notes about this user...",rows:3}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"sm",onClick:()=>C(s.id),children:"Save"}),e.jsx(l,{size:"sm",variant:"outline",onClick:U,children:"Cancel"})]})]}):e.jsxs("div",{className:"space-y-2",children:[s.block_notes?e.jsx("div",{className:"text-sm bg-muted p-2 rounded",children:s.block_notes}):e.jsx("div",{className:"text-sm text-muted-foreground italic",children:"No notes"}),e.jsxs(l,{size:"sm",variant:"ghost",onClick:()=>T(s.id,s.block_notes||""),children:[e.jsx(D,{className:"h-4 w-4 mr-1"}),"Edit Notes"]})]})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:["KYC: ",s.kyc_status||"Pending"]}),e.jsxs("div",{children:["Transactions: ",s.transactionCount]})]})}),e.jsx(i,{children:e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{confirm("Are you sure you want to unblock this user?")&&h.mutate(s.id)},disabled:h.isPending,children:"Unblock User"})})]},s.id)})})]})})]})]})]})}export{I as default};
