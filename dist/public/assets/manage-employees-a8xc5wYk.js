import{c as Ce,ax as n,J as we,r as E,a2 as z,a3 as Q,d as Ne,i as S,j as e,B as u,aG as Ee,I as h,C as Se,N as Fe,O as Pe,Q as ke,e as Te,L as q,aH as _e,f as F,ab as R,ac as o,ad as c,ae as d,af as m,ah as p,z as U,A as B,D as H,E as Y,F as J,aI as P,U as W,V as X,W as Z,X as ee,ag as se,ak as C,aE as x}from"./index-DzUQlMCL.js";import{T as Le,a as Ge,b as ae,c as f,d as Ve,e as v}from"./table-CxCbk9gb.js";import{D as le,b as ne,c as ie,d as re,e as te,f as oe}from"./dialog-kbAvU9vg.js";import{C as k}from"./checkbox-DMV5nDXs.js";import{S as De}from"./search-BvG8QWW9.js";import{T as Me}from"./trash-2-D7Ii7HN2.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=Ce("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),j=[{label:"Transactions",permissions:[{id:"view_transactions",label:"View Transactions",description:"Can view all transaction history and details"},{id:"edit_transactions",label:"Edit Transactions",description:"Can modify transaction details and information"},{id:"change_transaction_status",label:"Change Transaction Status",description:"Can approve, reject, or mark transactions as suspicious"}]},{label:"Clients",permissions:[{id:"view_clients",label:"View Clients List",description:"Can view the list of all clients in the system"},{id:"view_client_details",label:"View Client Details",description:"Can access detailed information about clients"},{id:"edit_client_info",label:"Edit Client Information",description:"Can modify client personal and account information"}]},{label:"KYC",permissions:[{id:"change_kyc_status",label:"Change KYC Status",description:"Can approve or reject KYC verifications"},{id:"manage_kyc",label:"Manage KYC System",description:"Can access and manage the KYC verification system"}]},{label:"Other",permissions:[{id:"view_analytics",label:"View Analytics",description:"Can access analytics and reporting dashboards"},{id:"manage_documents",label:"Manage Documents",description:"Can upload, view, and manage system documents"}]}],I=()=>j.flatMap(g=>g.permissions.map(T=>T.id)),qe=n.object({username:n.string().min(3,"Username must be at least 3 characters"),fullName:n.string().min(3,"Full name is required"),email:n.string().email("Please enter a valid email address"),password:n.string().min(8,"Password must be at least 8 characters"),userGroup:n.string(),permissions:n.record(n.boolean()).optional()}),Ie=n.object({id:n.number(),fullName:n.string().min(3,"Full name is required"),email:n.string().email("Please enter a valid email address"),userGroup:n.string(),permissions:n.record(n.boolean()).optional()}),Ue=()=>{const g=we(),[T,w]=E.useState(!1),[ce,N]=E.useState(!1),[_,de]=E.useState(null),[L,me]=E.useState(""),i=z({resolver:Q(qe),defaultValues:{username:"",fullName:"",email:"",password:"",userGroup:"finance_emp",permissions:I().reduce((s,a)=>(s[a]=!1,s),{})}}),t=z({resolver:Q(Ie),defaultValues:{id:0,fullName:"",email:"",userGroup:"",permissions:{}}}),{data:G,isLoading:ue,isError:pe}=Ne({queryKey:["employees"],queryFn:async()=>(await C.get("/api/admin/employees")).data.employees}),V=S({mutationFn:async s=>{console.log("Creating employee with data:",{...s,password:s.password?"***":void 0});const a=s.permissions||I().reduce((r,b)=>(r[b]=!1,r),{}),l={...s,permissions:a};return console.log("Sending employee create request:",{...l,password:"***"}),(await C.post("/api/admin/employees",l)).data},onSuccess:s=>{console.log("Employee created successfully:",s),x({title:"Success",description:"Employee account created successfully"}),w(!1),i.reset(),g.invalidateQueries({queryKey:["employees"]})},onError:s=>{var a,l;console.error("Error creating employee:",s),x({title:"Error",description:((l=(a=s.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to create employee",variant:"destructive"})}}),D=S({mutationFn:async s=>{console.log("Updating employee permissions for ID:",s.id);const l={permissions:s.permissions||I().reduce((r,b)=>(r[b]=!1,r),{}),fullName:s.fullName,email:s.email,userGroup:s.userGroup};return console.log("Sending permission update payload:",l),(await C.patch(`/api/admin/employees/${s.id}/permissions`,l)).data},onSuccess:s=>{console.log("Employee permissions updated successfully:",s),x({title:"Success",description:"Employee permissions updated successfully"}),N(!1),g.invalidateQueries({queryKey:["employees"]})},onError:s=>{var a,l;console.error("Error updating employee permissions:",s),x({title:"Error",description:((l=(a=s.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to update employee permissions",variant:"destructive"})}}),xe=S({mutationFn:async s=>(await C.delete(`/api/admin/employees/${s}`)).data,onSuccess:()=>{x({title:"Success",description:"Employee deleted successfully"}),g.invalidateQueries({queryKey:["employees"]})},onError:s=>{var a,l;x({title:"Error",description:((l=(a=s.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to delete employee",variant:"destructive"})}}),he=S({mutationFn:async s=>(await C.post(`/api/admin/employees/${s}/reset-password`)).data,onSuccess:s=>{x({title:"Password Reset",description:`New temporary password: ${s.temporaryPassword}`})},onError:s=>{var a,l;x({title:"Error",description:((l=(a=s.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to reset password",variant:"destructive"})}}),je=s=>{V.mutate(s)},ye=s=>{D.mutate(s)},be=s=>{de(s),t.reset({id:s.id,fullName:s.fullName,email:s.email,userGroup:s.userGroup,permissions:s.permissions||{}}),N(!0)},fe=s=>{window.confirm("Are you sure you want to delete this employee? This action cannot be undone.")&&xe.mutate(s)},ve=s=>{window.confirm("Are you sure you want to reset this employee's password?")&&he.mutate(s)},A=(G==null?void 0:G.filter(s=>{const a=L.toLowerCase();return s.username.toLowerCase().includes(a)||s.fullName.toLowerCase().includes(a)||s.email.toLowerCase().includes(a)}))||[],M=[{value:"kyc_employee",label:"KYC Specialist"},{value:"finance_emp",label:"Finance Manager"},{value:"viewonly_employee",label:"View Only Employee"},{value:"second_admin",label:"Secondary Admin"}],ge=s=>{const a=M.find(l=>l.value===s);return a?a.label:s},K=(s,a)=>{var y;return(((y=j.find(r=>r.label===s))==null?void 0:y.permissions)||[]).every(r=>a[r.id])},$=(s,a,l)=>{var b;const y=((b=j.find(O=>O.label===s))==null?void 0:b.permissions)||[],r={...l.getValues().permissions};y.forEach(O=>{r[O.id]=a}),l.setValue("permissions",r)};return e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Employee Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Create and manage employee accounts with customizable permissions"})]}),e.jsxs(u,{onClick:()=>w(!0),children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Create Employee"]})]}),e.jsx("div",{className:"flex items-center mb-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(De,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(h,{type:"search",placeholder:"Search employees...",className:"pl-8",value:L,onChange:s=>me(s.target.value)})]})}),e.jsxs(Se,{children:[e.jsxs(Fe,{children:[e.jsx(Pe,{children:"Employee Accounts"}),e.jsx(ke,{children:"Manage employee accounts and their access rights"})]}),e.jsx(Te,{children:ue?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(q,{className:"h-8 w-8 animate-spin text-primary"})}):pe?e.jsx("div",{className:"text-center py-8 text-destructive",children:"Failed to load employees. Please try again."}):A.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:L?"No employees found matching your search.":"No employees created yet."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Le,{children:[e.jsx(Ge,{children:e.jsxs(ae,{children:[e.jsx(f,{children:"Employee"}),e.jsx(f,{children:"Role"}),e.jsx(f,{children:"Email"}),e.jsx(f,{children:"Permissions"}),e.jsx(f,{children:"Status"}),e.jsx(f,{className:"text-right",children:"Actions"})]})}),e.jsx(Ve,{children:A.map(s=>e.jsxs(ae,{children:[e.jsx(v,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_e,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{children:s.fullName}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["@",s.username]})]})]})}),e.jsx(v,{children:e.jsx(F,{variant:"outline",children:ge(s.userGroup)})}),e.jsx(v,{children:s.email}),e.jsx(v,{children:e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[s.permissions&&Object.entries(s.permissions).filter(([a,l])=>l).slice(0,3).map(([a])=>e.jsx(F,{variant:"secondary",className:"text-xs",children:a.replace(/_/g," ")},a)),s.permissions&&Object.values(s.permissions).filter(Boolean).length>3&&e.jsxs(F,{variant:"secondary",className:"text-xs",children:["+",Object.values(s.permissions).filter(Boolean).length-3," more"]})]})}),e.jsx(v,{children:e.jsx(F,{variant:s.status==="active"?"default":"secondary",className:s.status==="active"?"bg-green-500 hover:bg-green-600":"",children:s.status||"Active"})}),e.jsx(v,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>be(s),children:e.jsx(Oe,{className:"h-4 w-4"})}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>ve(s.id),children:"Reset Pwd"}),e.jsx(u,{variant:"destructive",size:"sm",onClick:()=>fe(s.id),children:e.jsx(Me,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]}),e.jsx(le,{open:T,onOpenChange:w,children:e.jsxs(ne,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsx(re,{children:"Create New Employee"}),e.jsx(te,{children:"Create a new employee account with customized permissions"})]}),e.jsx(R,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(je),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(o,{control:i.control,name:"username",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Username"}),e.jsx(m,{children:e.jsx(h,{placeholder:"johndoe",...s})}),e.jsx(p,{})]})}),e.jsx(o,{control:i.control,name:"fullName",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Full Name"}),e.jsx(m,{children:e.jsx(h,{placeholder:"John Doe",...s})}),e.jsx(p,{})]})}),e.jsx(o,{control:i.control,name:"email",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Email"}),e.jsx(m,{children:e.jsx(h,{type:"email",placeholder:"john.doe@example.com",...s})}),e.jsx(p,{})]})}),e.jsx(o,{control:i.control,name:"password",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Password"}),e.jsx(m,{children:e.jsx(h,{type:"password",placeholder:"••••••••",...s})}),e.jsx(p,{})]})}),e.jsx(o,{control:i.control,name:"userGroup",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Role"}),e.jsxs(U,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(B,{children:e.jsx(H,{placeholder:"Select a role"})})}),e.jsx(Y,{children:M.map(a=>e.jsx(J,{value:a.value,children:a.label},a.value))})]}),e.jsx(p,{})]})})]}),e.jsx(P,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Permissions"}),e.jsxs(W,{defaultValue:"transactions",children:[e.jsx(X,{className:"mb-4",children:j.map(s=>e.jsx(Z,{value:s.label.toLowerCase(),children:s.label},s.label))}),j.map(s=>e.jsxs(ee,{value:s.label.toLowerCase(),className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{id:`select-all-${s.label}`,checked:i.watch("permissions")?K(s.label,i.watch("permissions")):!1,onCheckedChange:a=>{$(s.label,a===!0,i)}}),e.jsxs("label",{htmlFor:`select-all-${s.label}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:["Select all ",s.label.toLowerCase()," permissions"]})]}),e.jsx(P,{className:"my-2"}),s.permissions.map(a=>e.jsx("div",{className:"flex flex-col space-y-2 border-b pb-2 last:border-0",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(o,{control:i.control,name:`permissions.${a.id}`,render:({field:l})=>e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(m,{children:e.jsx(k,{checked:l.value,onCheckedChange:l.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(d,{className:"font-medium",children:a.label}),e.jsx(se,{children:a.description})]})]})})})},a.id))]},s.label))]})]}),e.jsxs(oe,{children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsxs(u,{type:"submit",disabled:V.isPending,children:[V.isPending&&e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Employee"]})]})]})})]})}),e.jsx(le,{open:ce,onOpenChange:N,children:e.jsxs(ne,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsxs(re,{children:["Edit Employee: ",_==null?void 0:_.fullName]}),e.jsx(te,{children:"Modify employee details and permissions"})]}),e.jsx(R,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(ye),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(o,{control:t.control,name:"fullName",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Full Name"}),e.jsx(m,{children:e.jsx(h,{...s})}),e.jsx(p,{})]})}),e.jsx(o,{control:t.control,name:"email",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Email"}),e.jsx(m,{children:e.jsx(h,{type:"email",...s})}),e.jsx(p,{})]})}),e.jsx(o,{control:t.control,name:"userGroup",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Role"}),e.jsxs(U,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(B,{children:e.jsx(H,{placeholder:"Select a role"})})}),e.jsx(Y,{children:M.map(a=>e.jsx(J,{value:a.value,children:a.label},a.value))})]}),e.jsx(p,{})]})})]}),e.jsx(P,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Permissions"}),e.jsxs(W,{defaultValue:"transactions",children:[e.jsx(X,{className:"mb-4",children:j.map(s=>e.jsx(Z,{value:s.label.toLowerCase(),children:s.label},s.label))}),j.map(s=>e.jsxs(ee,{value:s.label.toLowerCase(),className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{id:`edit-select-all-${s.label}`,checked:t.watch("permissions")?K(s.label,t.watch("permissions")):!1,onCheckedChange:a=>{$(s.label,a===!0,t)}}),e.jsxs("label",{htmlFor:`edit-select-all-${s.label}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:["Select all ",s.label.toLowerCase()," permissions"]})]}),e.jsx(P,{className:"my-2"}),s.permissions.map(a=>e.jsx("div",{className:"flex flex-col space-y-2 border-b pb-2 last:border-0",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(o,{control:t.control,name:`permissions.${a.id}`,render:({field:l})=>e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(m,{children:e.jsx(k,{checked:l.value,onCheckedChange:l.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(d,{className:"font-medium",children:a.label}),e.jsx(se,{children:a.description})]})]})})})},a.id))]},s.label))]})]}),e.jsxs(oe,{children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsxs(u,{type:"submit",disabled:D.isPending,children:[D.isPending&&e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]})]})]})})]})})]})};export{Ue as default};
