import{aK as l,aL as G,aM as Z,aN as _,aO as H,aP as M,aQ as ee,ax as q,r as se,J as ae,d as P,i as E,a2 as ne,j as e,U as te,V as re,W as C,X as F,C as b,N as v,O as N,aR as ie,Q as w,e as I,M as de,aS as X,aT as ce,B as L,a6 as le,a7 as oe,a8 as ue,aa as me,ab as he,ac as K,ad as Q,ae as Y,af as U,I as k,ak as S,aE as B,a3 as xe,f as O}from"./index-DzUQlMCL.js";import{T as z,f as V,a as J,b as D,c as g,d as W,e as j}from"./table-CxCbk9gb.js";import{A as je}from"./layout-Dhtj2VcD.js";import{T as $}from"./trash-2-D7Ii7HN2.js";import"./chart-column-CcdXueSi.js";import"./search-BvG8QWW9.js";import"./hard-drive-nPyOXBYa.js";import"./log-out-DkZZLLuv.js";function R(n,t){const a=l(n),d=l(t),r=a.getTime()-d.getTime();return r<0?-1:r>0?1:r}function fe(n){return G(n,Date.now())}function ge(n,t){const a=l(n),d=l(t),r=a.getFullYear()-d.getFullYear(),o=a.getMonth()-d.getMonth();return r*12+o}function ye(n){return t=>{const d=(n?Math[n]:Math.trunc)(t);return d===0?0:d}}function pe(n,t){return+l(n)-+l(t)}function be(n){const t=l(n);return t.setHours(23,59,59,999),t}function ve(n){const t=l(n),a=t.getMonth();return t.setFullYear(t.getFullYear(),a+1,0),t.setHours(23,59,59,999),t}function Ne(n){const t=l(n);return+be(t)==+ve(t)}function we(n,t){const a=l(n),d=l(t),r=R(a,d),o=Math.abs(ge(a,d));let h;if(o<1)h=0;else{a.getMonth()===1&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-r*o);let i=R(a,d)===-r;Ne(l(n))&&o===1&&R(n,d)===1&&(i=!1),h=r*(o-Number(i))}return h===0?0:h}function Ie(n,t,a){const d=pe(n,t)/1e3;return ye(a==null?void 0:a.roundingMethod)(d)}function Se(n,t,a){const d=ee(),r=(a==null?void 0:a.locale)??d.locale??Z,o=2520,h=R(n,t);if(isNaN(h))throw new RangeError("Invalid time value");const i=Object.assign({},a,{addSuffix:a==null?void 0:a.addSuffix,comparison:h});let y,p;h>0?(y=l(t),p=l(n)):(y=l(n),p=l(t));const m=Ie(p,y),A=(_(p)-_(y))/1e3,c=Math.round((m-A)/60);let f;if(c<2)return a!=null&&a.includeSeconds?m<5?r.formatDistance("lessThanXSeconds",5,i):m<10?r.formatDistance("lessThanXSeconds",10,i):m<20?r.formatDistance("lessThanXSeconds",20,i):m<40?r.formatDistance("halfAMinute",0,i):m<60?r.formatDistance("lessThanXMinutes",1,i):r.formatDistance("xMinutes",1,i):c===0?r.formatDistance("lessThanXMinutes",1,i):r.formatDistance("xMinutes",c,i);if(c<45)return r.formatDistance("xMinutes",c,i);if(c<90)return r.formatDistance("aboutXHours",1,i);if(c<H){const x=Math.round(c/60);return r.formatDistance("aboutXHours",x,i)}else{if(c<o)return r.formatDistance("xDays",1,i);if(c<M){const x=Math.round(c/H);return r.formatDistance("xDays",x,i)}else if(c<M*2)return f=Math.round(c/M),r.formatDistance("aboutXMonths",f,i)}if(f=we(p,y),f<12){const x=Math.round(c/M);return r.formatDistance("xMonths",x,i)}else{const x=f%12,T=Math.trunc(f/12);return x<3?r.formatDistance("aboutXYears",T,i):x<9?r.formatDistance("overXYears",T,i):r.formatDistance("almostXYears",T+1,i)}}function De(n,t){return Se(n,fe(n),t)}const Ae=q.object({ipAddress:q.string().min(7,"Please enter a valid IP address"),reason:q.string().optional()}),Re=()=>{const[n,t]=se.useState("dashboard"),a=ae();P({queryKey:["/api/admin/security/dashboard"],queryFn:async()=>(await S.get("/api/admin/security/dashboard")).data});const{data:d,isLoading:r}=P({queryKey:["/api/admin/security/banned-ips"],queryFn:async()=>(await S.get("/api/admin/security/banned-ips")).data.bannedIPs||[]}),{data:o,isLoading:h}=P({queryKey:["/api/admin/security/logs"],queryFn:async()=>(await S.get("/api/admin/security/logs")).data.logs||[]}),{data:i,isLoading:y}=P({queryKey:["/api/admin/security/stats"],queryFn:async()=>(await S.get("/api/admin/security/stats")).data}),p=E({mutationFn:async s=>(await S.post("/api/admin/security/unban",{ipAddress:s})).data,onSuccess:()=>{B({title:"IP Unbanned",description:"The IP address has been successfully unbanned.",variant:"default"}),a.invalidateQueries({queryKey:["/api/admin/security/banned-ips"]}),a.invalidateQueries({queryKey:["/api/admin/security/dashboard"]})},onError:s=>{B({title:"Error",description:"Failed to unban IP address. Please try again.",variant:"destructive"})}}),m=ne({resolver:xe(Ae),defaultValues:{ipAddress:"",reason:""}}),A=E({mutationFn:async s=>(await S.post("/api/admin/security/manual-ban",s)).data,onSuccess:()=>{B({title:"IP Banned",description:"The IP address has been successfully banned.",variant:"default"}),m.reset(),a.invalidateQueries({queryKey:["/api/admin/security/banned-ips"]}),a.invalidateQueries({queryKey:["/api/admin/security/dashboard"]})},onError:s=>{B({title:"Error",description:"Failed to ban IP address. Please try again.",variant:"destructive"})}}),c=s=>{A.mutate(s)},f=s=>{window.confirm(`Are you sure you want to unban ${s}?`)&&p.mutate(s)},x=s=>{switch(s){case"high":return e.jsx(O,{variant:"destructive",children:"High"});case"medium":return e.jsx(O,{variant:"secondary",children:"Medium"});case"low":return e.jsx(O,{variant:"outline",children:"Low"});default:return e.jsx(O,{variant:"outline",children:"Info"})}},T=[{id:"security",title:"Security Dashboard",defaultSize:100,content:e.jsxs("div",{className:"container py-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Security Dashboard"}),e.jsxs(te,{value:n,onValueChange:t,children:[e.jsxs(re,{className:"grid grid-cols-4 mb-6",children:[e.jsx(C,{value:"dashboard",children:"Overview"}),e.jsx(C,{value:"logs",children:"Security Logs"}),e.jsx(C,{value:"banned",children:"Banned IPs"}),e.jsx(C,{value:"actions",children:"Actions"})]}),e.jsx(F,{value:"dashboard",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs(b,{children:[e.jsxs(v,{className:"pb-2",children:[e.jsxs(N,{className:"text-lg flex items-center",children:[e.jsx(ie,{className:"mr-2 h-5 w-5 text-green-500"}),"Security Overview"]}),e.jsx(w,{children:"Current security status and statistics"})]}),e.jsx(I,{children:y?e.jsxs("div",{className:"animate-pulse space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded"})]}):i?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Attempts:"}),e.jsx("span",{className:"font-medium",children:i.totalAttempts})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Banned IPs:"}),e.jsx("span",{className:"font-medium",children:i.bannedIPs})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Login Failures:"}),e.jsx("span",{className:"font-medium",children:i.loginFailures})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"CAPTCHA Shown:"}),e.jsx("span",{className:"font-medium",children:i.captchaShown})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Suspicious Activities:"}),e.jsx("span",{className:"font-medium",children:i.suspiciousActivities})]}),e.jsxs("div",{className:"pt-2 text-xs text-muted-foreground",children:["Last updated: ",i.lastUpdated?new Date(i.lastUpdated).toLocaleString():"N/A"]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No statistics available"})})]}),e.jsxs(b,{children:[e.jsxs(v,{className:"pb-2",children:[e.jsxs(N,{className:"text-lg flex items-center",children:[e.jsx(de,{className:"mr-2 h-5 w-5 text-red-500"}),"Recent Incidents"]}),e.jsx(w,{children:"Latest security incidents"})]}),e.jsx(I,{children:h?e.jsxs("div",{className:"animate-pulse space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded"})]}):o&&o.length>0?e.jsx(X,{className:"h-[200px]",children:e.jsx("div",{className:"space-y-2",children:o.slice(0,5).map((s,u)=>e.jsxs("div",{className:"border-b pb-2 last:border-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"text-sm",children:s.message}),x(s.severity)]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(s.timestamp).toLocaleString()})]},u))})}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No recent incidents"})})]}),e.jsxs(b,{children:[e.jsxs(v,{className:"pb-2",children:[e.jsxs(N,{className:"text-lg flex items-center",children:[e.jsx(ce,{className:"mr-2 h-5 w-5 text-yellow-500"}),"Banned IP Addresses"]}),e.jsx(w,{children:"Recent IP bans"})]}),e.jsx(I,{children:r?e.jsxs("div",{className:"animate-pulse space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded"})]}):d&&d.length>0?e.jsx(X,{className:"h-[200px]",children:e.jsx("div",{className:"space-y-2",children:d.slice(0,5).map((s,u)=>e.jsxs("div",{className:"border-b pb-2 last:border-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-medium",children:s.ipAddress}),e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>f(s.ipAddress),children:e.jsx($,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Banned ",De(new Date(s.timestamp),{addSuffix:!0}),s.reason&&e.jsxs("span",{children:[" - ",s.reason]})]})]},u))})}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No banned IP addresses"})})]})]})}),e.jsx(F,{value:"logs",children:e.jsxs(b,{children:[e.jsxs(v,{children:[e.jsx(N,{children:"Security Logs"}),e.jsx(w,{children:"Detailed security events and incidents"})]}),e.jsx(I,{children:h?e.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((s,u)=>e.jsx("div",{className:"h-12 bg-gray-200 rounded"},u))}):e.jsx(X,{className:"h-[500px]",children:e.jsxs(z,{children:[e.jsx(V,{children:"A list of recent security logs"}),e.jsx(J,{children:e.jsxs(D,{children:[e.jsx(g,{children:"Time"}),e.jsx(g,{children:"Message"}),e.jsx(g,{children:"Severity"}),e.jsx(g,{children:"IP Address"})]})}),e.jsx(W,{children:o&&o.length>0?o.map((s,u)=>e.jsxs(D,{children:[e.jsx(j,{className:"font-medium whitespace-nowrap",children:new Date(s.timestamp).toLocaleString()}),e.jsx(j,{children:s.message}),e.jsx(j,{children:x(s.severity)}),e.jsx(j,{children:s.ipAddress||"N/A"})]},u)):e.jsx(D,{children:e.jsx(j,{colSpan:4,className:"text-center",children:"No security logs available"})})})]})})})]})}),e.jsx(F,{value:"banned",children:e.jsxs(b,{children:[e.jsxs(v,{children:[e.jsx(N,{children:"Banned IP Addresses"}),e.jsx(w,{children:"IP addresses that have been banned due to suspicious activity"})]}),e.jsx(I,{children:r?e.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((s,u)=>e.jsx("div",{className:"h-12 bg-gray-200 rounded"},u))}):e.jsxs(z,{children:[e.jsx(V,{children:"A list of banned IP addresses"}),e.jsx(J,{children:e.jsxs(D,{children:[e.jsx(g,{children:"IP Address"}),e.jsx(g,{children:"Ban Date"}),e.jsx(g,{children:"Reason"}),e.jsx(g,{children:"Actions"})]})}),e.jsx(W,{children:d&&d.length>0?d.map((s,u)=>e.jsxs(D,{children:[e.jsx(j,{className:"font-medium",children:s.ipAddress}),e.jsx(j,{children:new Date(s.timestamp).toLocaleString()}),e.jsx(j,{children:s.reason||"Automatic ban (suspicious activity)"}),e.jsx(j,{children:e.jsx(le,{children:e.jsxs(oe,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>f(s.ipAddress),children:e.jsx($,{className:"h-4 w-4"})})}),e.jsx(me,{children:e.jsx("p",{children:"Unban this IP address"})})]})})})]},u)):e.jsx(D,{children:e.jsx(j,{colSpan:4,className:"text-center",children:"No banned IP addresses"})})})]})})]})}),e.jsx(F,{value:"actions",children:e.jsxs(b,{children:[e.jsxs(v,{children:[e.jsx(N,{children:"Security Actions"}),e.jsx(w,{children:"Manual security controls and actions"})]}),e.jsx(I,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Ban IP Address"}),e.jsx(he,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(c),className:"space-y-4",children:[e.jsx(K,{control:m.control,name:"ipAddress",render:({field:s})=>e.jsxs(Q,{children:[e.jsx(Y,{children:"IP Address"}),e.jsx(U,{children:e.jsx(k,{placeholder:"Enter IP address to ban",...s})})]})}),e.jsx(K,{control:m.control,name:"reason",render:({field:s})=>e.jsxs(Q,{children:[e.jsx(Y,{children:"Reason (Optional)"}),e.jsx(U,{children:e.jsx(k,{placeholder:"Reason for ban",...s})})]})}),e.jsx(L,{type:"submit",disabled:A.isPending,children:A.isPending?"Banning...":"Ban IP Address"})]})})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Security Documentation"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Our security implementation includes the following features:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground mb-4",children:[e.jsx("li",{children:"IP-based abuse detection system"}),e.jsx("li",{children:"Rate limiting for sensitive operations"}),e.jsx("li",{children:"Two-factor authentication for admin access"}),e.jsx("li",{children:"CAPTCHA for suspicious login attempts"}),e.jsx("li",{children:"Automatic IP banning for brute force attempts"}),e.jsx("li",{children:"Security headers for web protection"}),e.jsx("li",{children:"TLS 1.3 with modern cipher suites"})]}),e.jsx(L,{variant:"outline",onClick:()=>window.open("/security-policy","_blank"),children:"View Full Security Documentation"})]})]})})]})})]})]})}];return e.jsx(je,{panels:T})};export{Re as default};
