import{c as D,b as I,a as $,r as w,d as q,j as e,C as p,e as f,B as g,L as z,I as H,f as K,g as U,S as G}from"./index-DzUQlMCL.js";import{T as N,a as _,b as d,c as n,d as v,e as c}from"./table-CxCbk9gb.js";import{A as M}from"./layout-Dhtj2VcD.js";import{S as Q}from"./search-BvG8QWW9.js";import"./chart-column-CcdXueSi.js";import"./hard-drive-nPyOXBYa.js";import"./log-out-DkZZLLuv.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=D("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),S=10,Z=a=>{switch(a.toLowerCase()){case"completed":case"successful":case"approved":return"default";case"failed":case"rejected":return"destructive";default:return"secondary"}};function te(){const a=I(),[b,C]=$(),[r,u]=w.useState(1),[i,L]=w.useState(""),{data:l,isLoading:T,error:P,refetch:k,isFetching:h}=q({queryKey:["/api/admin/clients",r,i],queryFn:async()=>{try{console.log("Fetching clients with credentials, page:",r,"search:",i);const s=new URLSearchParams({page:r.toString(),limit:S.toString(),...i&&{search:i}}),t=await fetch(`/api/admin/clients?${s}`,{credentials:"include",headers:{Accept:"application/json","Cache-Control":"no-cache, no-store"}});if(console.log("Response headers:",{status:t.status,statusText:t.statusText,contentType:t.headers.get("Content-Type"),cacheControl:t.headers.get("Cache-Control")}),!t.ok){if(console.error("Failed to fetch clients:",t.status,t.statusText),t.status===401)throw console.log("Authentication error detected, redirecting to login"),setTimeout(()=>{window.location.href="/login?redirect=/admin/clients"},1e3),new Error("Authentication required. Redirecting to login...");let j=a("error_loading_clients");try{const o=await t.json();o.message&&(j=o.message),o.details&&(j+=": "+o.details)}catch(o){console.error("Could not parse error details:",o)}throw new Error(j)}const x=await t.json();return console.log("Clients data loaded successfully:",{count:x.clients.length,totalPages:x.totalPages,currentPage:x.currentPage}),x}catch(s){throw console.error("Error fetching clients:",s),s}},staleTime:3e4,retry:1,retryDelay:1e3}),y=(l==null?void 0:l.clients)||[],m=(l==null?void 0:l.totalPages)||1,A=s=>{const t=`/admin/clients/${s}`;C(t)},E=()=>{r>1&&u(r-1)},F=()=>{r<m&&u(r+1)},B=s=>{L(s),u(1)},R=[{id:"clients",title:a("clients"),defaultSize:100,content:e.jsx("div",{className:"container py-6",children:T?e.jsx(J,{}):P?e.jsx(p,{children:e.jsxs(f,{className:"p-6 text-center",children:[e.jsx("p",{className:"text-destructive mb-4",children:a("error_loading_clients")}),e.jsx(g,{onClick:()=>k(),variant:"outline",className:"mt-2",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"mr-2 h-4 w-4 animate-spin"}),a("loading")]}):a("try_again")})]})}):e.jsx(p,{children:e.jsxs(f,{className:"p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Q,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(H,{placeholder:a("search_clients"),value:i,onChange:s=>B(s.target.value),className:"pl-10"})]})}),e.jsxs(N,{children:[e.jsx(_,{children:e.jsxs(d,{className:"border-b border-border/40",children:[e.jsx(n,{children:a("auth_username")}),e.jsx(n,{children:a("full_name")}),e.jsx(n,{children:a("auth_email")}),e.jsx(n,{children:a("dashboard_kyc")}),e.jsx(n,{children:a("dashboard_balance")}),e.jsx(n,{children:a("dashboard_last_login")})]})}),e.jsxs(v,{children:[y.map(s=>{const t=typeof s.balance=="number"?s.balance.toFixed(2):parseFloat(s.balance||"0").toFixed(2);return e.jsxs(d,{className:"cursor-pointer hover:bg-accent/5 border-b border-border/40",onClick:()=>A(s.id),children:[e.jsx(c,{children:s.username}),e.jsx(c,{children:s.fullName||"-"}),e.jsx(c,{children:s.email||"-"}),e.jsx(c,{children:e.jsx(K,{variant:Z(s.kycStatus),children:a(`kyc_status_${s.kycStatus.toLowerCase()}`)})}),e.jsxs(c,{children:["$",t]}),e.jsx(c,{children:s.lastLoginAt?new Date(s.lastLoginAt).toLocaleDateString():"-"})]},s.id)}),y.length===0&&e.jsx(d,{children:e.jsx(c,{colSpan:6,className:"text-center py-4 text-muted-foreground",children:a("dashboard_no_clients")})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a("pagination_info",{current:r,total:m})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:E,disabled:r===1||h,children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),a("previous")]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:F,disabled:r===m||h,children:[a("next"),e.jsx(U,{className:"h-4 w-4 ml-1"})]})]})]})]})})})}];return e.jsx(M,{panels:R})}function J(){return e.jsx(p,{children:e.jsx(f,{className:"p-6",children:e.jsxs(N,{children:[e.jsx(_,{children:e.jsxs(d,{children:[e.jsx(n,{children:"Username"}),e.jsx(n,{children:"Full Name"}),e.jsx(n,{children:"Email"}),e.jsx(n,{children:"KYC Status"}),e.jsx(n,{children:"Balance"}),e.jsx(n,{children:"Last Login"})]})}),e.jsx(v,{children:[...Array(S)].map((a,b)=>e.jsx(d,{children:[...Array(6)].map((C,r)=>e.jsx(c,{children:e.jsx(G,{className:"h-4 w-24"})},r))},b))})]})})})}export{te as default};
