import{u as U,b as I,a as K,d as O,j as e,C as c,N as j,e as x,O as p,U as W,V as H,W as _,X as S}from"./index-DzUQlMCL.js";import{A as E}from"./layout-Dhtj2VcD.js";import{B as L,C as f,X as v,L as d,Y as u,T as y,a as b,b as A,R as P}from"./BarChart-BJux3iWp.js";import{L as $,a as C,T as q}from"./LineChart-Cdgvi4LU.js";import{T as M}from"./trending-down-BMP5vP7Q.js";import"./chart-column-CcdXueSi.js";import"./search-BvG8QWW9.js";import"./hard-drive-nPyOXBYa.js";import"./log-out-DkZZLLuv.js";const N=({children:n})=>e.jsx("div",{className:"relative h-[400px] w-full",children:e.jsx(P,{width:"100%",height:"100%",children:n})}),t={margin:{top:20,right:30,left:20,bottom:30},gridDashArray:"3 3",axisHeight:60,axisAngle:-45,labelOffset:{bottom:20,left:10,right:10},lineStrokeWidth:2,dotRadius:{normal:4,active:6},legendHeight:36,chartHeight:400},w=(n,s)=>{const m=new Date(n);switch(s){case"hourly":return m.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});case"daily":return m.toLocaleDateString([],{weekday:"short"});case"weekly":return`Week ${Math.ceil(m.getDate()/7)}`;default:return n}},l=n=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),k=({active:n,payload:s,label:m})=>n&&s&&s.length?e.jsxs("div",{className:"bg-background border rounded-lg p-3 shadow-lg",children:[e.jsx("p",{className:"font-medium",children:m}),s.map((a,D)=>e.jsxs("p",{className:"flex items-center gap-2",style:{color:a.color},children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:a.color}}),e.jsxs("span",{children:[a.name,": "]}),e.jsx("span",{className:"font-medium",children:a.name.toLowerCase().includes("volume")||a.name.toLowerCase().includes("amount")?l(a.value):a.value.toLocaleString()})]},D))]}):null,r=({title:n,value:s,subtitle:m,trend:a})=>e.jsxs(c,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:n}),a!==void 0&&e.jsxs("span",{className:`flex items-center ${a>=0?"text-green-500":"text-red-500"}`,children:[a>=0?e.jsx(q,{className:"h-4 w-4"}):e.jsx(M,{className:"h-4 w-4"}),e.jsxs("span",{className:"ml-1 text-xs",children:[Math.abs(a),"%"]})]})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s}),m&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:m})]})]});function ee(){const{user:n}=U(),s=I(),[,m]=K();if(n&&!n.isAdmin)return m("/dashboard"),null;const{data:a,isLoading:D,error:R}=O({queryKey:["/api/admin/analytics"],queryFn:async()=>{const o=await fetch("/api/admin/analytics",{credentials:"include",headers:{Accept:"application/json","Cache-Control":"no-cache"}});if(!o.ok)throw new Error("Failed to fetch analytics data");return o.json()},enabled:!!(n!=null&&n.isAdmin),staleTime:5*60*1e3,retry:2});if(D||!(a!=null&&a.yearToDate))return e.jsxs("div",{className:"container py-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-8",children:s("dashboard_analytics")}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(o=>e.jsxs(c,{children:[e.jsx(j,{className:"pb-2",children:e.jsx("div",{className:"h-4 w-24 bg-muted rounded animate-pulse"})}),e.jsxs(x,{children:[e.jsx("div",{className:"h-8 w-32 bg-muted rounded animate-pulse mb-2"}),e.jsx("div",{className:"h-3 w-40 bg-muted rounded animate-pulse"})]})]},o))}),e.jsxs(c,{children:[e.jsx(j,{children:e.jsx("div",{className:"h-6 w-32 bg-muted rounded animate-pulse"})}),e.jsx(x,{children:e.jsx("div",{className:"h-[400px] w-full bg-muted rounded animate-pulse"})})]})]})]});if(R)return e.jsx("div",{className:"container py-6",children:e.jsx(c,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-2",children:s("analytics_error")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("please_try_again_later")})]})})})});const i=a.yearToDate,g=a.daily,h=a.weekly,T=a.monthly,F=[{id:"analytics",title:s("analytics"),defaultSize:100,content:e.jsxs("div",{className:"container py-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-8",children:s("dashboard_analytics")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsx(r,{title:s("total_transactions"),value:i.totalTransactions.toLocaleString(),subtitle:`${s("sepa")}: ${i.deposits.count} | USDT/USDC: ${i.orders.count}`,trend:5.2}),e.jsx(r,{title:s("total_volume"),value:l(i.totalAmount),subtitle:`${s("sepa")}: ${l(i.deposits.amount)} | USDT/USDC: ${l(i.orders.amount)}`,trend:3.8}),e.jsx(r,{title:s("active_users"),value:i.uniqueActiveUsers.toLocaleString(),subtitle:`${s("total_clients")}: ${i.totalClients.toLocaleString()}`,trend:-1.5}),e.jsx(r,{title:s("success_rate"),value:`${((i.deposits.count+i.orders.count)/i.totalTransactions*100).toFixed(1)}%`,subtitle:s("completed_transactions"),trend:.5})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"SEPA Deposit Commission Analytics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(r,{title:"Commission Rate",value:`${(i.commissionRate*100).toFixed(0)}%`,subtitle:"Fixed rate for all SEPA deposits"}),e.jsx(r,{title:"Total Commission Earned",value:l(i.deposits.commissionAmount),subtitle:`From ${i.deposits.count} deposits`}),e.jsx(r,{title:"Average Commission Per Deposit",value:l(i.deposits.count>0?i.deposits.commissionAmount/i.deposits.count:0),subtitle:"Per transaction average"})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Commission by Time Period"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(r,{title:"Daily Commission",value:l(g.depositCommissionAmount),subtitle:`From ${g.depositCount} deposits today`}),e.jsx(r,{title:"Weekly Commission",value:l(h.depositCommissionAmount),subtitle:`From ${h.depositCount} deposits this week`}),e.jsx(r,{title:"Monthly Commission",value:l(T.depositCommissionAmount),subtitle:`From ${T.depositCount} deposits this month`})]})]}),e.jsxs(c,{className:"mb-8",children:[e.jsxs(j,{children:[e.jsx(p,{children:"Commission Fee Trends"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Weekly comparison of deposit volume vs commission earned"})]}),e.jsx(x,{children:e.jsx(N,{children:e.jsxs(L,{data:h.timeline.map(o=>({...o,timestamp:w(o.timestamp,"daily"),estimatedCommission:o.deposits*(i.deposits.commissionAmount/i.deposits.count)})),margin:t.margin,children:[e.jsx(f,{strokeDasharray:t.gridDashArray}),e.jsx(v,{dataKey:"timestamp",angle:t.axisAngle,textAnchor:"end",height:t.axisHeight,children:e.jsx(d,{value:"Day",position:"bottom",offset:t.labelOffset.bottom})}),e.jsx(u,{yAxisId:"left",children:e.jsx(d,{value:"Volume ($)",angle:-90,position:"left",offset:t.labelOffset.left})}),e.jsx(u,{yAxisId:"right",orientation:"right",children:e.jsx(d,{value:"Commission ($)",angle:90,position:"right",offset:t.labelOffset.right})}),e.jsx(y,{content:e.jsx(k,{})}),e.jsx(b,{verticalAlign:"top",height:t.legendHeight}),e.jsx(A,{yAxisId:"left",name:"Deposit Volume",dataKey:"amount",fill:"hsl(var(--primary))",radius:[4,4,0,0]}),e.jsx(A,{yAxisId:"right",name:"Commission Earned",dataKey:"estimatedCommission",fill:"hsl(var(--destructive))",radius:[4,4,0,0]})]})})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Commission Efficiency Metrics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(r,{title:"Commission Ratio",value:`${(i.deposits.commissionAmount/i.deposits.amount*100).toFixed(2)}%`,subtitle:"Commission as % of post-fee deposit volume"}),e.jsx(r,{title:"Revenue per User",value:l(i.uniqueActiveUsers>0?i.deposits.commissionAmount/i.uniqueActiveUsers:0),subtitle:"Average commission per active user"}),e.jsx(r,{title:"Commission Trend",value:h.depositCount>0&&g.depositCount>0?`${(g.depositCommissionAmount/g.depositCount/(h.depositCommissionAmount/h.depositCount)*100-100).toFixed(1)}%`:"0%",subtitle:"Daily vs weekly average change"})]})]}),i.contractors&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Contractor Referral Analytics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[e.jsx(r,{title:"Active Contractors",value:i.contractors.count.toLocaleString(),subtitle:"Contractors with referral codes"}),e.jsx(r,{title:"Referred Deposits",value:i.contractors.referredDeposits.toLocaleString(),subtitle:"Deposits from referred clients"}),e.jsx(r,{title:"Referred Amount",value:l(i.contractors.referredAmount),subtitle:"Total volume from referred clients"}),e.jsx(r,{title:"Contractor Commissions",value:l(i.contractors.commissionAmount),subtitle:"At standard rate of 0.85%"})]})]}),e.jsxs(W,{defaultValue:"daily",className:"space-y-4",children:[e.jsxs(H,{className:"grid w-full grid-cols-3 lg:w-[400px]",children:[e.jsx(_,{value:"daily",children:s("daily")}),e.jsx(_,{value:"weekly",children:s("weekly")}),e.jsx(_,{value:"monthly",children:s("monthly")})]}),e.jsx(S,{value:"daily",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(j,{children:[e.jsx(p,{children:s("hourly_activity")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("today_transactions_overview")})]}),e.jsx(x,{children:e.jsx(N,{children:e.jsxs(L,{data:g.timeline.map(o=>({...o,timestamp:w(o.timestamp,"hourly")})),margin:t.margin,children:[e.jsx(f,{strokeDasharray:t.gridDashArray}),e.jsx(v,{dataKey:"timestamp",angle:t.axisAngle,textAnchor:"end",height:t.axisHeight,children:e.jsx(d,{value:s("time"),position:"bottom",offset:t.labelOffset.bottom})}),e.jsx(u,{children:e.jsx(d,{value:s("count"),angle:-90,position:"left",offset:t.labelOffset.left})}),e.jsx(y,{content:e.jsx(k,{})}),e.jsx(b,{verticalAlign:"top",height:t.legendHeight}),e.jsx(A,{name:s("deposits"),dataKey:"deposits",fill:"hsl(var(--primary))",radius:[4,4,0,0]}),e.jsx(A,{name:s("orders"),dataKey:"orders",fill:"hsl(var(--destructive))",radius:[4,4,0,0]})]})})})]})}),e.jsx(S,{value:"weekly",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(j,{children:[e.jsx(p,{children:s("daily_breakdown")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("weekly_transactions_overview")})]}),e.jsx(x,{children:e.jsx(N,{children:e.jsxs($,{data:h.timeline.map(o=>({...o,timestamp:w(o.timestamp,"daily")})),margin:t.margin,children:[e.jsx(f,{strokeDasharray:t.gridDashArray}),e.jsx(v,{dataKey:"timestamp",angle:t.axisAngle,textAnchor:"end",height:t.axisHeight,children:e.jsx(d,{value:s("day"),position:"bottom",offset:t.labelOffset.bottom})}),e.jsx(u,{yAxisId:"left",children:e.jsx(d,{value:s("volume"),angle:-90,position:"left",offset:t.labelOffset.left})}),e.jsx(u,{yAxisId:"right",orientation:"right",children:e.jsx(d,{value:s("users"),angle:90,position:"right",offset:t.labelOffset.right})}),e.jsx(y,{content:e.jsx(k,{})}),e.jsx(b,{verticalAlign:"top",height:t.legendHeight}),e.jsx(C,{yAxisId:"left",name:s("transaction_volume"),type:"monotone",dataKey:"amount",stroke:"hsl(var(--primary))",strokeWidth:t.lineStrokeWidth,dot:{r:t.dotRadius.normal},activeDot:{r:t.dotRadius.active}}),e.jsx(C,{yAxisId:"right",name:s("active_users"),type:"monotone",dataKey:"activeUsers",stroke:"hsl(var(--destructive))",strokeWidth:t.lineStrokeWidth,dot:{r:t.dotRadius.normal},activeDot:{r:t.dotRadius.active}})]})})})]})}),e.jsx(S,{value:"monthly",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(j,{children:[e.jsx(p,{children:s("monthly_trends")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("monthly_transactions_overview")})]}),e.jsx(x,{children:e.jsx(N,{children:e.jsxs($,{data:T.timeline.map(o=>({...o,timestamp:w(o.timestamp,"weekly")})),margin:t.margin,children:[e.jsx(f,{strokeDasharray:t.gridDashArray}),e.jsx(v,{dataKey:"timestamp",angle:t.axisAngle,textAnchor:"end",height:t.axisHeight,children:e.jsx(d,{value:s("week"),position:"bottom",offset:t.labelOffset.bottom})}),e.jsx(u,{yAxisId:"left",children:e.jsx(d,{value:s("volume"),angle:-90,position:"left",offset:t.labelOffset.left})}),e.jsx(u,{yAxisId:"right",orientation:"right",children:e.jsx(d,{value:s("users"),angle:90,position:"right",offset:t.labelOffset.right})}),e.jsx(y,{content:e.jsx(k,{})}),e.jsx(b,{verticalAlign:"top",height:t.legendHeight}),e.jsx(C,{yAxisId:"left",name:s("transaction_volume"),type:"monotone",dataKey:"amount",stroke:"hsl(var(--primary))",strokeWidth:t.lineStrokeWidth,dot:{r:t.dotRadius.normal},activeDot:{r:t.dotRadius.active}}),e.jsx(C,{yAxisId:"right",name:s("active_users"),type:"monotone",dataKey:"activeUsers",stroke:"hsl(var(--destructive))",strokeWidth:t.lineStrokeWidth,dot:{r:t.dotRadius.normal},activeDot:{r:t.dotRadius.active}})]})})})]})})]})]})}];return e.jsx(E,{panels:F})}export{ee as default};
